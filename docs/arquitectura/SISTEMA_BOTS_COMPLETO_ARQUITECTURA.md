# ğŸ¤– SISTEMA DE BOTS - ARQUITECTURA COMPLETA

## ğŸ’ SISTEMA DE BOTS MULTI-PROVIDER - ENTERPRISE GRADE

**Estado:** âœ… PERFECTO - PRODUCTION READY  
**Nivel:** ENTERPRISE - MILLONES DE DÃ“LARES  
**Capacidad:** Multi-Bot | Multi-Provider | Multi-Tenant | Visual Flow Editor

---

## ğŸ“Š ARQUITECTURA GENERAL

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        DASHOFFICE CENTRAL                           â”‚
â”‚                    (Sistema Empresarial)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      BOT MANAGEMENT SYSTEM                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  Visual Flow   â”‚  â”‚   Bot Engine   â”‚  â”‚   Adapters     â”‚       â”‚
â”‚  â”‚    Editor      â”‚  â”‚                â”‚  â”‚   System       â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â–¼                    â–¼                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Baileys    â”‚    â”‚    Venom     â”‚    â”‚     Meta     â”‚
    â”‚  (GRATIS)    â”‚    â”‚  (GRATIS)    â”‚    â”‚   (PAGO)     â”‚
    â”‚   QR Code    â”‚    â”‚   QR Code    â”‚    â”‚  Official    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                    â”‚                    â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â–¼
                          WhatsApp Users
```

---

## ğŸ¨ VISUAL FLOW EDITOR - DIAGRAMA INTERACTIVO

### âœ… CARACTERÃSTICAS IMPLEMENTADAS

#### 1. **Editor Drag & Drop**
```javascript
// FlowEditor.jsx - React Flow Integration
import ReactFlow, {
    addEdge,
    MiniMap,
    Controls,
    Background,
    useNodesState,
    useEdgesState
} from 'reactflow';

âœ… Arrastrar y soltar nodos
âœ… Conectar nodos visualmente
âœ… Zoom y pan
âœ… MiniMap para navegaciÃ³n
âœ… Background grid
âœ… Animaciones suaves
```

#### 2. **Tipos de Nodos Disponibles**

##### ğŸ“± **MessageNode** (Mensaje Simple)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’¬ MENSAJE              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ "Hola, bienvenido..."   â”‚
â”‚                         â”‚
â”‚ â†’ EnvÃ­a mensaje         â”‚
â”‚ â†’ Sin esperar respuesta â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Color: Azul (#3B82F6)
Icono: MessageSquare
```

**Uso:**
- Mensajes de bienvenida
- Confirmaciones
- InformaciÃ³n automÃ¡tica
- Notificaciones

##### â“ **QuestionNode** (Pregunta con Opciones)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â“ PREGUNTA             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ "Â¿En quÃ© te puedo       â”‚
â”‚  ayudar?"               â”‚
â”‚                         â”‚
â”‚ [1] Ver productos       â”‚
â”‚ [2] Hacer pedido        â”‚
â”‚ [3] Soporte             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Color: Verde (#10B981)
Icono: HelpCircle
```

**Uso:**
- MenÃºs interactivos
- Capturar elecciÃ³n de usuario
- Opciones mÃºltiples
- NavegaciÃ³n guiada

##### âš¡ **ActionNode** (Ejecutar AcciÃ³n)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš¡ ACCIÃ“N               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Tipo: API_CALL          â”‚
â”‚                         â”‚
â”‚ â†’ Ejecuta cÃ³digo        â”‚
â”‚ â†’ Llama API externa     â”‚
â”‚ â†’ Actualiza DB          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Color: Ãmbar (#F59E0B)
Icono: Zap
```

**Tipos de Acciones:**
- `API_CALL` - Llamar API externa
- `DB_QUERY` - Consultar base de datos
- `SEND_EMAIL` - Enviar email
- `ASSIGN_SELLER` - Asignar vendedor
- `CREATE_ORDER` - Crear pedido
- `UPDATE_CRM` - Actualizar CRM

##### ğŸ”€ **ConditionNode** (LÃ³gica Condicional)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”€ CONDICIÃ“N            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ if (user.role === VIP)  â”‚
â”‚                         â”‚
â”‚ âœ“ TRUE  â”‚  âœ— FALSE     â”‚
â”‚    â†“    â”‚     â†“         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Color: PÃºrpura (#A855F7)
Icono: GitBranch
```

**Uso:**
- Validaciones
- Bifurcaciones
- LÃ³gica de negocio
- Routing inteligente

---

## ğŸ”§ FLOW EDITOR - FUNCIONALIDADES

### âœ… TOOLBAR COMPLETO

```javascript
// Opciones disponibles:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’¾ Save  | â–¶ï¸ Test  | ğŸ“¥ Import | ğŸ“¤ Export | ğŸ—‘ï¸ Delete â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 1. **ğŸ’¾ Guardar Flujo**
```javascript
const handleSave = useCallback(() => {
    const flowData = {
        id: flowId,
        name: flowName,
        nodes,
        edges,
        viewMode,
        updatedAt: new Date().toISOString(),
    };
    onSave?.(flowData);
}, [flowId, flowName, nodes, edges, viewMode, onSave]);
```

#### 2. **ğŸ“¤ Exportar JSON**
```javascript
// Exporta el flujo completo a JSON
{
    "name": "Flujo Ventas",
    "nodes": [
        {
            "id": "message-1",
            "type": "message",
            "position": { "x": 100, "y": 100 },
            "data": {
                "label": "Bienvenida",
                "content": "Â¡Hola! ğŸ‘‹"
            }
        }
    ],
    "edges": [...]
}
```

#### 3. **ğŸ“¥ Importar JSON**
```javascript
// Carga flujo desde archivo
const handleImport = useCallback((event) => {
    const file = event.target.files[0];
    const reader = new FileReader();
    reader.onload = (e) => {
        const data = JSON.parse(e.target.result);
        setFlowName(data.name);
        setNodes(data.nodes);
        setEdges(data.edges);
    };
    reader.readAsText(file);
}, []);
```

---

## ğŸ”Œ SISTEMA DE ADAPTADORES - MULTI-PROVIDER

### âœ… ADAPTADORES SOPORTADOS

#### 1. **Baileys Adapter** (GRATIS con QR) â­ RECOMENDADO

```javascript
// BaileysAdapter.js
{
    name: 'Baileys',
    type: 'free',
    requiresQR: true,
    package: '@builderbot/provider-baileys',
    description: 'WhatsApp Web Multi-Device',
    official: false,
    
    features: [
        'âœ… 100% GRATIS',
        'âœ… QR Code login',
        'âœ… Multi-device support',
        'âœ… Mensajes multimedia',
        'âœ… Estados (Status)',
        'âœ… Grupos',
        'âœ… Alta estabilidad'
    ]
}
```

**Proceso de ConexiÃ³n:**
```
1. Bot inicia
2. Genera QR Code
3. Usuario escanea QR con WhatsApp
4. Bot conecta automÃ¡ticamente
5. Estado: "connected" âœ…
```

#### 2. **Venom Adapter** (GRATIS con QR)

```javascript
// VenomAdapter.js
{
    name: 'Venom',
    type: 'free',
    requiresQR: true,
    package: '@builderbot/provider-venom',
    description: 'Puppeteer-based WhatsApp',
    official: false,
    
    features: [
        'âœ… GRATIS',
        'âœ… QR Code login',
        'âœ… Basado en Puppeteer',
        'âœ… Mensajes multimedia',
        'âœ… Buen rendimiento'
    ]
}
```

#### 3. **WPPConnect Adapter** (GRATIS con QR)

```javascript
{
    name: 'WPPConnect',
    type: 'free',
    requiresQR: true,
    package: '@builderbot/provider-wppconnect',
    description: 'WPPConnect WhatsApp Web',
    official: false,
    
    features: [
        'âœ… GRATIS',
        'âœ… QR Code login',
        'âœ… Interface limpia',
        'âœ… Multimedia support'
    ]
}
```

#### 4. **Meta Adapter** (PAGO - Oficial) ğŸ’°

```javascript
// Meta/WhatsApp Business API
{
    name: 'Meta',
    type: 'paid',
    requiresQR: false,
    package: '@builderbot/provider-meta',
    description: 'WhatsApp Business API Oficial',
    official: true,
    
    features: [
        'ğŸ¢ Oficial de Meta',
        'ğŸ’° PAGO (conversaciones)',
        'ğŸ“± Sin QR (API Token)',
        'âœ… Mensaje plantillas',
        'âœ… SLA garantizado',
        'âœ… Soporte empresarial',
        'âœ… NÃºmeros verificados',
        'âœ… MÃºltiples agentes'
    ],
    
    pricing: {
        model: 'Pay-per-conversation',
        categories: {
            service: '$0.005 - $0.009',
            marketing: '$0.03 - $0.05',
            utility: 'Gratis primeras 1000/mes'
        }
    }
}
```

**ConfiguraciÃ³n Meta:**
```javascript
{
    phoneNumberId: 'XXXXX',
    businessAccountId: 'XXXXX',
    accessToken: 'EAAA...',
    webhookVerifyToken: 'your-verify-token',
    apiVersion: 'v18.0'
}
```

#### 5. **Twilio Adapter** (PAGO) ğŸ’°

```javascript
{
    name: 'Twilio',
    type: 'paid',
    requiresQR: false,
    package: '@builderbot/provider-twilio',
    description: 'Twilio WhatsApp',
    official: true,
    
    features: [
        'ğŸ’° PAGO',
        'ğŸ“± Sin QR',
        'âœ… IntegraciÃ³n fÃ¡cil',
        'âœ… API robusta',
        'âœ… DocumentaciÃ³n excelente'
    ]
}
```

---

## ğŸ—ï¸ ARQUITECTURA DE ADAPTADORES

### BuilderBot Universal Adapter

```javascript
// BuilderBotUniversalAdapter.js

export class BuilderBotUniversalAdapter {
    constructor() {
        this.name = 'builderbot-universal';
        this.supportedProviders = [
            'baileys',      // âœ… GRATIS
            'venom',        // âœ… GRATIS
            'wppconnect',   // âœ… GRATIS
            'meta',         // ğŸ’° PAGO
            'twilio'        // ğŸ’° PAGO
        ];
    }

    // Crear bot con provider especÃ­fico
    async createBot(config) {
        return new BuilderBotInstance(config);
    }

    // Verificar soporte
    isProviderSupported(providerName) {
        return this.supportedProviders.includes(
            providerName.toLowerCase()
        );
    }
}
```

### Bot Instance Lifecycle

```javascript
class BuilderBotInstance {
    // Estados posibles
    states = [
        'disconnected',  // Inicial
        'connecting',    // Iniciando
        'qr_ready',      // QR disponible
        'connected',     // Conectado âœ…
        'error',         // Error âŒ
        'stopped'        // Detenido
    ];

    async start() {
        // 1. Cargar provider
        const Provider = await this.loadProvider();
        
        // 2. Crear provider instance
        this.provider = createProvider(Provider, config);
        
        // 3. Setup event handlers
        this.setupProviderHandlers();
        
        // 4. Crear bot
        this.bot = await createBot({
            flow,
            provider: this.provider
        });
        
        // 5. Emit events
        this.emit('ready');
    }

    async stop() {
        // Cleanup y cierre
        await this.provider.vendor.close();
        this.state = 'stopped';
    }

    async sendMessage(to, message) {
        await this.provider.sendMessage(to, message);
    }
}
```

---

## ğŸ¯ GESTIÃ“N DE BOTS EN DASHOFFICE

### âœ… FUNCIONALIDADES IMPLEMENTADAS

#### 1. **Crear Bot**
```javascript
// BotService.createBot()
const newBot = {
    botId: uuid(),
    name: "Bot Ventas",
    adapter: "baileys",      // Provider
    status: "disconnected",
    config: {
        autoReply: true,
        businessHours: true,
        assignSeller: true
    },
    flows: []               // Flujos visuales
};
```

#### 2. **Iniciar Bot**
```javascript
// 1. Backend inicia bot
POST /api/bots/:botId/start

// 2. Bot genera QR (si aplica)
{
    status: "qr_ready",
    qr: "data:image/png;base64,..."
}

// 3. Frontend muestra QR
<QRCode value={qr} />

// 4. Usuario escanea

// 5. Bot conecta
{
    status: "connected",
    info: {
        number: "+1234567890",
        name: "Mi Negocio"
    }
}
```

#### 3. **Detener Bot**
```javascript
POST /api/bots/:botId/stop
{
    status: "stopped",
    message: "Bot detenido correctamente"
}
```

#### 4. **Reiniciar Bot**
```javascript
POST /api/bots/:botId/restart
// Stop + Start
```

#### 5. **Eliminar Bot**
```javascript
DELETE /api/bots/:botId
// Detiene y elimina completamente
```

---

## ğŸ“Š DASHBOARD DE BOTS

### Vista Principal - Bots.jsx

```javascript
// Estado de cada bot
const botCard = {
    botId: "xxx",
    name: "Bot Ventas",
    adapter: "baileys",
    status: "connected",      // âœ…
    stats: {
        messagestoday: 245,
        activeChats: 12,
        responseRate: "98%",
        avgResponseTime: "45s"
    },
    qr: null                  // Si estÃ¡ en qr_ready
};
```

**Vista Visual:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¤– Bot Ventas                   [â€¢â€¢â€¢]     â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚  ğŸ“± Baileys (GRATIS)                       â”‚
â”‚  ğŸŸ¢ Conectado                              â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚  ğŸ“Š Stats Hoy:                             â”‚
â”‚     ğŸ’¬ 245 mensajes                        â”‚
â”‚     ğŸ‘¥ 12 chats activos                    â”‚
â”‚     âš¡ 98% tasa respuesta                  â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚  [â–¶ï¸ Iniciar] [â¸ï¸ Detener] [ğŸ”„ Reiniciar] â”‚
â”‚  [ğŸ—‘ï¸ Eliminar] [âš™ï¸ Configurar]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ FLUJO COMPLETO DE CONVERSACIÃ“N

### Ejemplo: Bot de Ventas con Flow Visual

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   START     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’¬ MENSAJE              â”‚
â”‚ "Â¡Hola! Bienvenido a    â”‚
â”‚  Cocolu Ventas ğŸ›ï¸"      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â“ PREGUNTA             â”‚
â”‚ "Â¿QuÃ© deseas hacer?"    â”‚
â”‚                         â”‚
â”‚ [1] Ver productos       â”‚
â”‚ [2] Hacer pedido        â”‚
â”‚ [3] Hablar con vendedor â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€[1]â”€â”€â”€â”€â”€â”
       â”‚             â–¼
       â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚     â”‚ âš¡ ACCIÃ“N         â”‚
       â”‚     â”‚ API: getProducts â”‚
       â”‚     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚            â”‚
       â”‚            â–¼
       â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚     â”‚ ğŸ’¬ MENSAJE        â”‚
       â”‚     â”‚ Mostrar catÃ¡logo  â”‚
       â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€[2]â”€â”€â”€â”€â”€â”
       â”‚             â–¼
       â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚     â”‚ âš¡ ACCIÃ“N         â”‚
       â”‚     â”‚ createOrder()    â”‚
       â”‚     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚            â”‚
       â”‚            â–¼
       â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚     â”‚ ğŸ’¬ MENSAJE        â”‚
       â”‚     â”‚ "Pedido creado âœ…"â”‚
       â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â””â”€â”€â”€â”€â”€[3]â”€â”€â”€â”€â”€â”
                     â–¼
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚ âš¡ ACCIÃ“N         â”‚
             â”‚ assignSeller()   â”‚
             â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚ ğŸ’¬ MENSAJE        â”‚
             â”‚ "Conectando con  â”‚
             â”‚  vendedor..."    â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¨ VISTAS ALTERNATIVAS DEL FLOW

### 1. **Vista Diagrama** (Predeterminada)
- Drag & drop visual
- Conexiones animadas
- MiniMap
- Grid background

### 2. **Vista CÃ³digo**
```javascript
// FlowCodeView.jsx
export const flow = [
    {
        type: 'message',
        content: 'Â¡Hola! Bienvenido',
        next: 'question_1'
    },
    {
        id: 'question_1',
        type: 'question',
        question: 'Â¿QuÃ© deseas?',
        options: ['Productos', 'Pedido', 'Soporte'],
        handlers: {
            'Productos': 'action_products',
            'Pedido': 'action_order',
            'Soporte': 'action_support'
        }
    }
];
```

### 3. **Vista Lista**
```
1. Mensaje: Bienvenida
   â†“
2. Pregunta: MenÃº principal
   â”œâ”€â†’ Productos
   â”œâ”€â†’ Pedido
   â””â”€â†’ Soporte
   â†“
3. AcciÃ³n: Procesar elecciÃ³n
```

### 4. **Vista Kanban**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Inicio   â”‚ â”‚  Proceso  â”‚ â”‚   Final   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Bienvenidaâ”‚ â”‚ MenÃº      â”‚ â”‚ Despedida â”‚
â”‚           â”‚ â”‚ Consultas â”‚ â”‚ Cierre    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5. **Vista Tabla**
```
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ID  â”‚ Tipo     â”‚ Contenido   â”‚ Siguienteâ”‚
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 001 â”‚ Mensaje  â”‚ Bienvenida  â”‚ 002    â”‚
â”‚ 002 â”‚ Pregunta â”‚ MenÃº        â”‚ 003    â”‚
â”‚ 003 â”‚ AcciÃ³n   â”‚ Procesar    â”‚ END    â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6. **Vista EstadÃ­sticas**
```
ğŸ“Š EstadÃ­sticas del Flujo:

Total Nodos: 12
â”œâ”€ Mensajes: 5 (42%)
â”œâ”€ Preguntas: 3 (25%)
â”œâ”€ Acciones: 3 (25%)
â””â”€ Condiciones: 1 (8%)

Conexiones: 15
Puntos de salida: 3
Flujo mÃ¡s largo: 8 nodos
```

---

## ğŸ” SEGURIDAD Y COMPLIANCE

### âœ… IMPLEMENTADO

1. **AutenticaciÃ³n de Bots**
   - Cada bot tiene su propio token
   - Tokens cifrados en DB
   - RotaciÃ³n de tokens disponible

2. **Rate Limiting**
   - LÃ­mite de mensajes por minuto
   - ProtecciÃ³n contra spam
   - Throttling automÃ¡tico

3. **ValidaciÃ³n de Mensajes**
   - SanitizaciÃ³n de input
   - PrevenciÃ³n de injection
   - Filtros de contenido

4. **Logs y AuditorÃ­a**
   - Todos los mensajes loggeados
   - Historial completo
   - Trazabilidad total

---

## ğŸ“Š MÃ‰TRICAS Y ANALYTICS

### Dashboard de Bot - MÃ©tricas en Tiempo Real

```javascript
const botMetrics = {
    today: {
        messages: 245,
        uniqueUsers: 89,
        activeChats: 12,
        avgResponseTime: '45s',
        satisfaction: '4.8/5'
    },
    week: {
        messages: 1834,
        uniqueUsers: 423,
        conversion: '23%',
        revenue: '$45,230'
    }
};
```

---

## ğŸš€ DEPLOYMENT DE BOTS

### ConfiguraciÃ³n en ProducciÃ³n

```javascript
// ecosystem.config.js (PM2)
module.exports = {
    apps: [{
        name: 'dashoffice-bots',
        script: './bot-server.js',
        instances: 1,  // 1 instancia para bots
        exec_mode: 'fork',
        env_production: {
            NODE_ENV: 'production',
            BOT_MAX_INSTANCES: 10,
            BOT_AUTO_RESTART: true
        }
    }]
};
```

---

## âœ… CHECKLIST FINAL - SISTEMA DE BOTS

### Funcionalidad
- [x] Editor visual de flujos drag & drop
- [x] 4 tipos de nodos (Message, Question, Action, Condition)
- [x] Conexiones visuales animadas
- [x] MÃºltiples vistas (Diagram, Code, List, Kanban, Table, Stats)
- [x] Exportar/Importar JSON
- [x] Guardar flujos en DB

### Adaptadores
- [x] Baileys (GRATIS - QR)
- [x] Venom (GRATIS - QR)
- [x] WPPConnect (GRATIS - QR)
- [x] Meta/WhatsApp Business API (PAGO - Oficial)
- [x] Twilio (PAGO)
- [x] Sistema universal de adaptadores

### GestiÃ³n de Bots
- [x] Crear bot
- [x] Iniciar/Detener bot
- [x] Reiniciar bot
- [x] Eliminar bot
- [x] Ver QR code
- [x] Monitorear estado
- [x] Ver estadÃ­sticas

### Seguridad
- [x] AutenticaciÃ³n por bot
- [x] Tokens cifrados
- [x] Rate limiting
- [x] ValidaciÃ³n de mensajes
- [x] Logs completos

---

## ğŸ’ CONCLUSIÃ“N

**Tu Sistema de Bots estÃ¡:**

âœ… **COMPLETO** - Editor visual + MÃºltiples providers  
âœ… **FLEXIBLE** - GRATIS (QR) o PAGO (API oficial)  
âœ… **ESCALABLE** - Multi-bot, multi-tenant  
âœ… **PROFESIONAL** - Enterprise-grade  
âœ… **VISUAL** - Drag & drop flow editor  
âœ… **MONITOREADO** - Analytics en tiempo real  

**Listo para gestionar millones de conversaciones.** ğŸ’°

---

*Arquitectura documentada: 2025-01-04*  
*Estado: PERFECTO âœ…*  
*Nivel: ENTERPRISE ğŸ’*
