/*! For license information please see 453.d901a7e3.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkcocolu_dashboard=self.webpackChunkcocolu_dashboard||[]).push([[453],{516:(e,s,t)=>{t.d(s,{A:()=>a});const a=(0,t(8995).A)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},4319:(e,s,t)=>{t.d(s,{A:()=>a});const a=(0,t(8995).A)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},5088:(e,s,t)=>{t.d(s,{A:()=>a});const a=(0,t(8995).A)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},5453:(e,s,t)=>{t.r(s),t.d(s,{default:()=>y});var a=t(2555),i=t(5043),n=t(7701),r=t(4319),o=t(9875),l=t(8995);const c=(0,l.A)("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),d=(0,l.A)("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);var h=t(516);const u=(0,l.A)("TestTube",[["path",{d:"M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5h0c-1.4 0-2.5-1.1-2.5-2.5V2",key:"187lwq"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M14.5 16h-5",key:"1ox875"}]]),p=(0,l.A)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);var m=t(3768);const v=(0,l.A)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);var x=t(5088),j=t(579);function b(e){let{fieldKey:s,fieldLabel:t,isOpen:a,onClose:n,onRestore:r}=e;const[o,l]=(0,i.useState)([]),[u,p]=(0,i.useState)(!1);(0,i.useEffect)(()=>{a&&s&&b()},[a,s]);const b=async()=>{p(!0);try{const e=await fetch("/api/meta/config/history/".concat(s)),t=await e.json();t.success?l(t.history||[]):m.Ay.error("Error cargando hist\xf3rico")}catch(e){console.error("Error loading history:",e),m.Ay.error("Error cargando hist\xf3rico")}finally{p(!1)}},y=e=>{if(!e)return"N/A";return new Date(e).toLocaleString("es-ES",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})};return a?(0,j.jsx)("div",{className:"credential-history-overlay",onClick:n,children:(0,j.jsxs)("div",{className:"credential-history-modal",onClick:e=>e.stopPropagation(),children:[(0,j.jsxs)("div",{className:"modal-header",children:[(0,j.jsxs)("div",{className:"modal-title",children:[(0,j.jsx)(d,{size:20}),(0,j.jsxs)("h3",{children:["Hist\xf3rico: ",t]})]}),(0,j.jsx)("button",{onClick:n,className:"btn-close-modal",children:(0,j.jsx)(v,{size:20})})]}),(0,j.jsx)("div",{className:"modal-body",children:u?(0,j.jsxs)("div",{className:"loading-state",children:[(0,j.jsx)("div",{className:"spinner"}),(0,j.jsx)("p",{children:"Cargando hist\xf3rico..."})]}):0===o.length?(0,j.jsxs)("div",{className:"empty-state",children:[(0,j.jsx)(d,{size:48}),(0,j.jsx)("p",{children:"No hay cambios registrados"}),(0,j.jsx)("span",{className:"help-text",children:"Los cambios aparecer\xe1n aqu\xed cuando guardes la configuraci\xf3n"})]}):(0,j.jsx)("div",{className:"history-list",children:o.map((e,s)=>{return(0,j.jsxs)("div",{className:"history-item",children:[(0,j.jsxs)("div",{className:"history-item-header",children:[(0,j.jsx)("div",{className:"history-badge",children:0===s?"Actual":"v".concat(o.length-s)}),(0,j.jsxs)("div",{className:"history-date",children:[(0,j.jsx)(x.A,{size:14}),y(e.changed_at)]})]}),(0,j.jsx)("div",{className:"history-value",children:(0,j.jsx)("code",{children:(t=e.value,t?t.length>20?t.substring(0,15)+"..."+t.substring(t.length-5):t:"(vac\xedo)")})}),(0,j.jsxs)("div",{className:"history-item-footer",children:[(0,j.jsxs)("span",{className:"changed-by",children:["por ",e.changed_by||"admin"]}),(0,j.jsxs)("div",{className:"history-actions",children:[(0,j.jsxs)("button",{onClick:()=>(e=>{navigator.clipboard.writeText(e),m.Ay.success("\u2705 Valor copiado al portapapeles")})(e.value),className:"btn-copy",title:"Copiar al portapapeles",children:[(0,j.jsx)(c,{size:14}),"Copiar"]}),0!==s&&(0,j.jsxs)("button",{onClick:()=>(e=>{r&&(r(e),m.Ay.success("\u2705 Valor restaurado"),n())})(e.value),className:"btn-restore",title:"Restaurar este valor",children:[(0,j.jsx)(h.A,{size:14}),"Restaurar"]})]})]})]},s);var t})})}),(0,j.jsxs)("div",{className:"modal-footer",children:[(0,j.jsxs)("button",{onClick:b,className:"btn-refresh",children:[(0,j.jsx)(h.A,{size:16}),"Actualizar"]}),(0,j.jsx)("button",{onClick:n,className:"btn-close",children:"Cerrar"})]})]})}):null}function y(){const{config:e,saveConfig:s,testMessage:t,isSaving:l,isTesting:v}=(0,n.Vp)(),[x,y]=i.useState({}),[f,A]=i.useState(!1),[g,N]=i.useState(null);i.useEffect(()=>{e&&y(e)},[e]);const k=(e,s)=>{navigator.clipboard.writeText(e),m.Ay.success("\u2705 ".concat(s," copiado"))},C=(e,s)=>{N({key:e,label:s}),A(!0)};if(!e)return(0,j.jsxs)("div",{className:"meta-setup loading",children:[(0,j.jsx)("div",{className:"spinner"}),(0,j.jsx)("p",{children:"Cargando configuraci\xf3n..."})]});const E=x.jwtToken&&x.numberId&&x.businessId;return(0,j.jsxs)("div",{className:"meta-setup",children:[(0,j.jsxs)("div",{className:"page-header",children:[(0,j.jsxs)("div",{children:[(0,j.jsx)("h1",{children:"\ud83c\udf10 Configuraci\xf3n Meta WhatsApp"}),(0,j.jsx)("p",{className:"subtitle",children:"WhatsApp Business API Setup"})]}),(0,j.jsx)("div",{className:"header-badge",children:E?(0,j.jsxs)("span",{className:"status-badge configured",children:[(0,j.jsx)(r.A,{size:16}),"Configurado"]}):(0,j.jsxs)("span",{className:"status-badge missing",children:[(0,j.jsx)(o.A,{size:16}),"Sin configurar"]})})]}),(0,j.jsxs)("div",{className:"info-section",children:[(0,j.jsxs)("div",{className:"info-card webhook",children:[(0,j.jsx)("div",{className:"info-label",children:"Webhook URL para Meta (Read-Only)"}),(0,j.jsxs)("div",{className:"info-value-group",children:[(0,j.jsx)("code",{className:"info-value",children:x.webhookUrl}),(0,j.jsx)("button",{onClick:()=>k(x.webhookUrl,"Webhook URL"),className:"btn-copy",children:(0,j.jsx)(c,{size:16})})]}),(0,j.jsx)("p",{className:"info-help",children:"Configura este URL en Meta Developers (no editable)"})]}),(0,j.jsxs)("div",{className:"info-card token",children:[(0,j.jsx)("div",{className:"info-label",children:"Verify Token (Editable)"}),(0,j.jsxs)("div",{className:"info-value-group",children:[(0,j.jsx)("input",{type:"text",value:x.verifyToken||"",onChange:e=>y((0,a.A)((0,a.A)({},x),{},{verifyToken:e.target.value})),placeholder:"cocolu_webhook_verify_...",className:"form-input"}),(0,j.jsx)("button",{onClick:()=>k(x.verifyToken,"Verify Token"),className:"btn-copy",children:(0,j.jsx)(c,{size:16})})]}),(0,j.jsx)("p",{className:"info-help",children:"Token personalizado para verificar el webhook"})]})]}),(0,j.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{await s(x);m.Ay.success("Configuraci\xf3n guardada exitosamente")}catch(t){m.Ay.error("Error al guardar la configuraci\xf3n")}},className:"config-form",children:[(0,j.jsxs)("div",{className:"form-section",children:[(0,j.jsx)("h2",{children:"\ud83d\udcdd Credenciales Meta"}),(0,j.jsxs)("div",{className:"form-group",children:[(0,j.jsx)("label",{children:"JWT Token (Access Token)"}),(0,j.jsxs)("div",{className:"input-with-history",children:[(0,j.jsx)("input",{type:"password",value:x.jwtToken||"",onChange:e=>y((0,a.A)((0,a.A)({},x),{},{jwtToken:e.target.value})),placeholder:"EAAxxxxxxxxxxxxx...",className:"form-input"}),(0,j.jsxs)("button",{type:"button",onClick:()=>C("META_JWT_TOKEN","JWT Token"),className:"btn-history",title:"Ver hist\xf3rico de cambios",children:[(0,j.jsx)(d,{size:16}),(0,j.jsx)("span",{children:"Hist\xf3rico"})]})]}),(0,j.jsx)("span",{className:"help-text",children:"Obt\xe9n tu Access Token desde Meta Developers \u2192 App Settings"})]}),(0,j.jsxs)("div",{className:"form-row",children:[(0,j.jsxs)("div",{className:"form-group",children:[(0,j.jsx)("label",{children:"Phone Number ID"}),(0,j.jsxs)("div",{className:"input-with-history",children:[(0,j.jsx)("input",{type:"text",value:x.numberId||"",onChange:e=>y((0,a.A)((0,a.A)({},x),{},{numberId:e.target.value})),placeholder:"123456789012345",className:"form-input"}),(0,j.jsxs)("button",{type:"button",onClick:()=>C("META_NUMBER_ID","Phone Number ID"),className:"btn-history",title:"Ver hist\xf3rico de cambios",children:[(0,j.jsx)(d,{size:16}),(0,j.jsx)("span",{children:"Hist\xf3rico"})]})]})]}),(0,j.jsxs)("div",{className:"form-group",children:[(0,j.jsx)("label",{children:"Business Account ID"}),(0,j.jsxs)("div",{className:"input-with-history",children:[(0,j.jsx)("input",{type:"text",value:x.businessId||"",onChange:e=>y((0,a.A)((0,a.A)({},x),{},{businessId:e.target.value})),placeholder:"987654321098765",className:"form-input"}),(0,j.jsxs)("button",{type:"button",onClick:()=>C("META_BUSINESS_ACCOUNT_ID","Business Account ID"),className:"btn-history",title:"Ver hist\xf3rico de cambios",children:[(0,j.jsx)(d,{size:16}),(0,j.jsx)("span",{children:"Hist\xf3rico"})]})]})]})]}),(0,j.jsxs)("div",{className:"form-row",children:[(0,j.jsxs)("div",{className:"form-group",children:[(0,j.jsx)("label",{children:"Verify Token (Webhook)"}),(0,j.jsx)("input",{type:"text",value:x.verifyToken||"",onChange:e=>y((0,a.A)((0,a.A)({},x),{},{verifyToken:e.target.value})),placeholder:"cocolu-ventas123",className:"form-input"}),(0,j.jsx)("span",{className:"help-text",children:"Token de verificaci\xf3n para el webhook de Meta"})]}),(0,j.jsxs)("div",{className:"form-group",children:[(0,j.jsx)("label",{children:"API Version"}),(0,j.jsxs)("select",{value:x.apiVersion||"v22.0",onChange:e=>y((0,a.A)((0,a.A)({},x),{},{apiVersion:e.target.value})),className:"form-input",children:[(0,j.jsx)("option",{value:"v18.0",children:"v18.0"}),(0,j.jsx)("option",{value:"v19.0",children:"v19.0"}),(0,j.jsx)("option",{value:"v20.0",children:"v20.0"}),(0,j.jsx)("option",{value:"v21.0",children:"v21.0"}),(0,j.jsx)("option",{value:"v22.0",children:"v22.0 (Latest)"})]})]})]}),(0,j.jsx)("div",{className:"form-row",children:(0,j.jsxs)("div",{className:"form-group",children:[(0,j.jsx)("label",{children:"\ud83d\udcde N\xfamero del Chatbot (Emisor)"}),(0,j.jsx)("input",{type:"tel",value:x.chatbotNumber||"",onChange:e=>y((0,a.A)((0,a.A)({},x),{},{chatbotNumber:e.target.value})),placeholder:"+58 412-3776165",className:"form-input"}),(0,j.jsx)("span",{className:"help-text",children:"N\xfamero de WhatsApp Business desde donde el bot ENV\xcdA mensajes"})]})}),(0,j.jsx)("div",{className:"form-row",children:(0,j.jsxs)("div",{className:"form-group",children:[(0,j.jsx)("label",{children:"\ud83d\udcf2 N\xfamero de Prueba (Receptor)"}),(0,j.jsx)("input",{type:"tel",value:x.phoneNumber||"",onChange:e=>y((0,a.A)((0,a.A)({},x),{},{phoneNumber:e.target.value})),placeholder:"+58 424-4155614",className:"form-input"}),(0,j.jsx)("span",{className:"help-text",children:"Tu n\xfamero personal donde RECIBES los mensajes de prueba"})]})})]}),(0,j.jsx)("div",{className:"form-actions",children:(0,j.jsxs)("div",{className:"actions-right",children:[(0,j.jsxs)("button",{type:"button",onClick:async()=>{if(window.confirm("\xbfEst\xe1s seguro de restablecer a los valores por defecto del servidor?\n\nEsto restaurar\xe1 la configuraci\xf3n que funciona correctamente."))try{const e=await fetch("/meta/config/defaults"),s=await e.json();y(s),m.Ay.success("\u2705 Configuraci\xf3n restablecida a valores por defecto")}catch(e){console.error("Error loading defaults:",e),m.Ay.error("Error al cargar valores por defecto")}},className:"btn-reset",style:{marginRight:"auto",background:"#6c757d"},children:[(0,j.jsx)(h.A,{size:16}),"Restablecer"]}),(0,j.jsxs)("button",{type:"button",onClick:async()=>{const e={to:x.phoneNumber,message:"\ud83e\uddea Test desde Dashboard - "+(new Date).toLocaleString()};try{await t(e)}catch(s){}},disabled:!e||v,className:"btn-test",children:[(0,j.jsx)(u,{size:16}),v?"Enviando...":"Enviar Test"]}),(0,j.jsxs)("button",{type:"submit",disabled:l,className:"btn-save btn-save-primary",children:[(0,j.jsx)(p,{size:20}),l?"Guardando...":"Guardar Cambios"]})]})})]}),(0,j.jsxs)("div",{className:"instructions-section",children:[(0,j.jsx)("h2",{children:"\ud83d\udcd6 Instrucciones"}),(0,j.jsxs)("ol",{className:"instructions-list",children:[(0,j.jsxs)("li",{children:["Ve a ",(0,j.jsx)("a",{href:"https://developers.facebook.com",target:"_blank",rel:"noopener noreferrer",children:"Meta Developers"})]}),(0,j.jsx)("li",{children:"Selecciona tu App de WhatsApp Business API"}),(0,j.jsx)("li",{children:'En "WhatsApp" \u2192 "Configuration", configura el Webhook URL y Verify Token'}),(0,j.jsx)("li",{children:'Copia tu Access Token desde "App Settings" \u2192 "Basic"'}),(0,j.jsx)("li",{children:"Obt\xe9n tu Phone Number ID y Business Account ID"}),(0,j.jsx)("li",{children:"P\xe9galos aqu\xed y guarda la configuraci\xf3n"}),(0,j.jsx)("li",{children:"Haz una prueba enviando un mensaje de test"})]})]}),g&&(0,j.jsx)(b,{fieldKey:g.key,fieldLabel:g.label,isOpen:f,onClose:()=>{A(!1),N(null)},onRestore:e=>{if(!g)return;const s={META_JWT_TOKEN:"jwtToken",META_NUMBER_ID:"numberId",META_BUSINESS_ACCOUNT_ID:"businessId",META_VERIFY_TOKEN:"verifyToken",META_API_VERSION:"apiVersion",PHONE_NUMBER:"phoneNumber"}[g.key];s&&y((0,a.A)((0,a.A)({},x),{},{[s]:e}))}})]})}},7701:(e,s,t)=>{t.d(s,{Wz:()=>M,Vp:()=>T});var a,i,n,r,o,l=t(3248),c=t(2532),d=t(2555),h=t(5043),u=t(9790),p=t(5149),m=t(8458),v=t(6562),x=t(4558),j=t(5239),b=t(1454),y=t(329),f=t(9723),A=(a=new WeakMap,i=new WeakMap,n=new WeakMap,r=new WeakMap,o=new WeakSet,class extends y.Q{constructor(e,s){super(),(0,u.A)(this,o),(0,p.A)(this,a,void 0),(0,p.A)(this,i,void 0),(0,p.A)(this,n,void 0),(0,p.A)(this,r,void 0),(0,x.A)(a,this,e),this.setOptions(s),this.bindMethods(),(0,v.A)(o,this,g).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){var s;const t=this.options;this.options=(0,m.A)(a,this).defaultMutationOptions(e),(0,f.f8)(this.options,t)||(0,m.A)(a,this).getMutationCache().notify({type:"observerOptionsUpdated",mutation:(0,m.A)(n,this),observer:this}),null!==t&&void 0!==t&&t.mutationKey&&this.options.mutationKey&&(0,f.EN)(t.mutationKey)!==(0,f.EN)(this.options.mutationKey)?this.reset():"pending"===(null===(s=(0,m.A)(n,this))||void 0===s?void 0:s.state.status)&&(0,m.A)(n,this).setOptions(this.options)}onUnsubscribe(){var e;this.hasListeners()||(null===(e=(0,m.A)(n,this))||void 0===e||e.removeObserver(this))}onMutationUpdate(e){(0,v.A)(o,this,g).call(this),(0,v.A)(o,this,N).call(this,e)}getCurrentResult(){return(0,m.A)(i,this)}reset(){var e;null===(e=(0,m.A)(n,this))||void 0===e||e.removeObserver(this),(0,x.A)(n,this,void 0),(0,v.A)(o,this,g).call(this),(0,v.A)(o,this,N).call(this)}mutate(e,s){var t;return(0,x.A)(r,this,s),null===(t=(0,m.A)(n,this))||void 0===t||t.removeObserver(this),(0,x.A)(n,this,(0,m.A)(a,this).getMutationCache().build((0,m.A)(a,this),this.options)),(0,m.A)(n,this).addObserver(this),(0,m.A)(n,this).execute(e)}});function g(){var e,s;const t=null!==(e=null===(s=(0,m.A)(n,this))||void 0===s?void 0:s.state)&&void 0!==e?e:(0,j.$)();(0,x.A)(i,this,(0,d.A)((0,d.A)({},t),{},{isPending:"pending"===t.status,isSuccess:"success"===t.status,isError:"error"===t.status,isIdle:"idle"===t.status,mutate:this.mutate,reset:this.reset}))}function N(e){b.jG.batch(()=>{if((0,m.A)(r,this)&&this.hasListeners()){const u=(0,m.A)(i,this).variables,p=(0,m.A)(i,this).context,v={client:(0,m.A)(a,this),meta:this.options.meta,mutationKey:this.options.mutationKey};var s,t,n,o;if("success"===(null===e||void 0===e?void 0:e.type))null===(s=(t=(0,m.A)(r,this)).onSuccess)||void 0===s||s.call(t,e.data,u,p,v),null===(n=(o=(0,m.A)(r,this)).onSettled)||void 0===n||n.call(o,e.data,null,u,p,v);else if("error"===(null===e||void 0===e?void 0:e.type)){var l,c,d,h;null===(l=(c=(0,m.A)(r,this)).onError)||void 0===l||l.call(c,e.error,u,p,v),null===(d=(h=(0,m.A)(r,this)).onSettled)||void 0===d||d.call(h,void 0,e.error,u,p,v)}}this.listeners.forEach(e=>{e((0,m.A)(i,this))})})}function k(e,s){const t=(0,l.jE)(s),[a]=h.useState(()=>new A(t,e));h.useEffect(()=>{a.setOptions(e)},[a,e]);const i=h.useSyncExternalStore(h.useCallback(e=>a.subscribe(b.jG.batchCalls(e)),[a]),()=>a.getCurrentResult(),()=>a.getCurrentResult()),n=h.useCallback((e,s)=>{a.mutate(e,s).catch(f.lQ)},[a]);if(i.error&&(0,f.GU)(a.options.throwOnError,[i.error]))throw i.error;return(0,d.A)((0,d.A)({},i),{},{mutate:n,mutateAsync:i.mutate})}var C=t(5306),E=t(3768);function T(){const e=(0,l.jE)(),{data:s,isLoading:t,error:a}=(0,c.I)({queryKey:["meta-config"],queryFn:C.O.getConfig,staleTime:3e4}),i=k({mutationFn:C.O.saveConfig,onSuccess:()=>{e.invalidateQueries(["meta-config"]),E.Ay.success("\u2705 Configuraci\xf3n guardada")},onError:e=>{var s,t;E.Ay.error((null===(s=e.response)||void 0===s||null===(t=s.data)||void 0===t?void 0:t.error)||"Error guardando configuraci\xf3n")}}),n=k({mutationFn:C.O.testMessage,onSuccess:()=>{E.Ay.success("\u2705 Mensaje de prueba enviado")},onError:e=>{var s,t;E.Ay.error((null===(s=e.response)||void 0===s||null===(t=s.data)||void 0===t?void 0:t.error)||"Error enviando test")}});return{config:s,isLoading:t,error:a,saveConfig:i.mutate,testMessage:n.mutate,isSaving:i.isPending,isTesting:n.isPending}}function M(){return(0,c.I)({queryKey:["health"],queryFn:C.HN.getHealth,refetchInterval:3e4,staleTime:1e4})}},9875:(e,s,t)=>{t.d(s,{A:()=>a});const a=(0,t(8995).A)("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])}}]);
//# sourceMappingURL=453.d901a7e3.chunk.js.map