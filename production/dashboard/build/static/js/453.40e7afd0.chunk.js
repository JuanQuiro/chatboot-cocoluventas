/*! For license information please see 453.40e7afd0.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkcocolu_dashboard=self.webpackChunkcocolu_dashboard||[]).push([[453],{516:(e,s,i)=>{i.d(s,{A:()=>t});const t=(0,i(8995).A)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},4319:(e,s,i)=>{i.d(s,{A:()=>t});const t=(0,i(8995).A)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},5088:(e,s,i)=>{i.d(s,{A:()=>t});const t=(0,i(8995).A)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},5453:(e,s,i)=>{i.r(s),i.d(s,{default:()=>b});var t=i(2555),a=i(5043),n=i(7701),r=i(4319),o=i(9875),l=i(8995);const c=(0,l.A)("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),d=(0,l.A)("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),h=(0,l.A)("TestTube",[["path",{d:"M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5h0c-1.4 0-2.5-1.1-2.5-2.5V2",key:"187lwq"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M14.5 16h-5",key:"1ox875"}]]),u=(0,l.A)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);var v=i(3768);const p=(0,l.A)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);var m=i(5088),x=i(516),j=i(579);function y(e){let{fieldKey:s,fieldLabel:i,isOpen:t,onClose:n,onRestore:r}=e;const[o,l]=(0,a.useState)([]),[c,h]=(0,a.useState)(!1);(0,a.useEffect)(()=>{t&&s&&u()},[t,s]);const u=async()=>{h(!0);try{const e=await fetch("/api/meta/config/history/".concat(s)),i=await e.json();i.success?l(i.history||[]):v.Ay.error("Error cargando hist\xf3rico")}catch(e){console.error("Error loading history:",e),v.Ay.error("Error cargando hist\xf3rico")}finally{h(!1)}},y=e=>{if(!e)return"N/A";return new Date(e).toLocaleString("es-ES",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})};return t?(0,j.jsx)("div",{className:"credential-history-overlay",onClick:n,children:(0,j.jsxs)("div",{className:"credential-history-modal",onClick:e=>e.stopPropagation(),children:[(0,j.jsxs)("div",{className:"modal-header",children:[(0,j.jsxs)("div",{className:"modal-title",children:[(0,j.jsx)(d,{size:20}),(0,j.jsxs)("h3",{children:["Hist\xf3rico: ",i]})]}),(0,j.jsx)("button",{onClick:n,className:"btn-close-modal",children:(0,j.jsx)(p,{size:20})})]}),(0,j.jsx)("div",{className:"modal-body",children:c?(0,j.jsxs)("div",{className:"loading-state",children:[(0,j.jsx)("div",{className:"spinner"}),(0,j.jsx)("p",{children:"Cargando hist\xf3rico..."})]}):0===o.length?(0,j.jsxs)("div",{className:"empty-state",children:[(0,j.jsx)(d,{size:48}),(0,j.jsx)("p",{children:"No hay cambios registrados"}),(0,j.jsx)("span",{className:"help-text",children:"Los cambios aparecer\xe1n aqu\xed cuando guardes la configuraci\xf3n"})]}):(0,j.jsx)("div",{className:"history-list",children:o.map((e,s)=>{return(0,j.jsxs)("div",{className:"history-item",children:[(0,j.jsxs)("div",{className:"history-item-header",children:[(0,j.jsx)("div",{className:"history-badge",children:0===s?"Actual":"v".concat(o.length-s)}),(0,j.jsxs)("div",{className:"history-date",children:[(0,j.jsx)(m.A,{size:14}),y(e.changed_at)]})]}),(0,j.jsx)("div",{className:"history-value",children:(0,j.jsx)("code",{children:(i=e.value,i?i.length>20?i.substring(0,15)+"..."+i.substring(i.length-5):i:"(vac\xedo)")})}),(0,j.jsxs)("div",{className:"history-item-footer",children:[(0,j.jsxs)("span",{className:"changed-by",children:["por ",e.changed_by||"admin"]}),0!==s&&(0,j.jsxs)("button",{onClick:()=>(e=>{r&&(r(e),v.Ay.success("Valor restaurado"),n())})(e.value),className:"btn-restore",children:[(0,j.jsx)(x.A,{size:14}),"Restaurar"]})]})]},s);var i})})}),(0,j.jsxs)("div",{className:"modal-footer",children:[(0,j.jsxs)("button",{onClick:u,className:"btn-refresh",children:[(0,j.jsx)(x.A,{size:16}),"Actualizar"]}),(0,j.jsx)("button",{onClick:n,className:"btn-close",children:"Cerrar"})]})]})}):null}function b(){const{config:e,saveConfig:s,testMessage:i,isSaving:l,isTesting:p}=(0,n.Vp)(),[m,x]=a.useState({}),[b,A]=a.useState(!1),[f,g]=a.useState(null);a.useEffect(()=>{e&&x(e)},[e]);const N=(e,s)=>{navigator.clipboard.writeText(e),v.Ay.success("\u2705 ".concat(s," copiado"))},k=(e,s)=>{g({key:e,label:s}),A(!0)};if(!e)return(0,j.jsxs)("div",{className:"meta-setup loading",children:[(0,j.jsx)("div",{className:"spinner"}),(0,j.jsx)("p",{children:"Cargando configuraci\xf3n..."})]});const C=m.jwtToken&&m.numberId&&m.businessId;return(0,j.jsxs)("div",{className:"meta-setup",children:[(0,j.jsxs)("div",{className:"page-header",children:[(0,j.jsxs)("div",{children:[(0,j.jsx)("h1",{children:"\ud83c\udf10 Configuraci\xf3n Meta WhatsApp"}),(0,j.jsx)("p",{className:"subtitle",children:"WhatsApp Business API Setup"})]}),(0,j.jsx)("div",{className:"header-badge",children:C?(0,j.jsxs)("span",{className:"status-badge configured",children:[(0,j.jsx)(r.A,{size:16}),"Configurado"]}):(0,j.jsxs)("span",{className:"status-badge missing",children:[(0,j.jsx)(o.A,{size:16}),"Sin configurar"]})})]}),(0,j.jsxs)("div",{className:"info-section",children:[(0,j.jsxs)("div",{className:"info-card webhook",children:[(0,j.jsx)("div",{className:"info-label",children:"Webhook URL para Meta (Read-Only)"}),(0,j.jsxs)("div",{className:"info-value-group",children:[(0,j.jsx)("code",{className:"info-value",children:m.webhookUrl}),(0,j.jsx)("button",{onClick:()=>N(m.webhookUrl,"Webhook URL"),className:"btn-copy",children:(0,j.jsx)(c,{size:16})})]}),(0,j.jsx)("p",{className:"info-help",children:"Configura este URL en Meta Developers (no editable)"})]}),(0,j.jsxs)("div",{className:"info-card token",children:[(0,j.jsx)("div",{className:"info-label",children:"Verify Token (Editable)"}),(0,j.jsxs)("div",{className:"info-value-group",children:[(0,j.jsx)("input",{type:"text",value:m.verifyToken||"",onChange:e=>x((0,t.A)((0,t.A)({},m),{},{verifyToken:e.target.value})),placeholder:"cocolu_webhook_verify_...",className:"form-input"}),(0,j.jsx)("button",{onClick:()=>N(m.verifyToken,"Verify Token"),className:"btn-copy",children:(0,j.jsx)(c,{size:16})})]}),(0,j.jsx)("p",{className:"info-help",children:"Token personalizado para verificar el webhook"})]})]}),(0,j.jsxs)("form",{onSubmit:e=>{e.preventDefault(),s(m)},className:"config-form",children:[(0,j.jsxs)("div",{className:"form-section",children:[(0,j.jsx)("h2",{children:"\ud83d\udcdd Credenciales Meta"}),(0,j.jsxs)("div",{className:"form-group",children:[(0,j.jsx)("label",{children:"JWT Token (Access Token)"}),(0,j.jsxs)("div",{className:"input-with-history",children:[(0,j.jsx)("input",{type:"password",value:m.jwtToken||"",onChange:e=>x((0,t.A)((0,t.A)({},m),{},{jwtToken:e.target.value})),placeholder:"EAAxxxxxxxxxxxxx...",className:"form-input"}),(0,j.jsx)("button",{type:"button",onClick:()=>k("META_JWT_TOKEN","JWT Token"),className:"btn-history",title:"Ver hist\xf3rico",children:(0,j.jsx)(d,{size:16})})]}),(0,j.jsx)("span",{className:"help-text",children:"Obt\xe9n tu Access Token desde Meta Developers \u2192 App Settings"})]}),(0,j.jsxs)("div",{className:"form-row",children:[(0,j.jsxs)("div",{className:"form-group",children:[(0,j.jsx)("label",{children:"Phone Number ID"}),(0,j.jsxs)("div",{className:"input-with-history",children:[(0,j.jsx)("input",{type:"text",value:m.numberId||"",onChange:e=>x((0,t.A)((0,t.A)({},m),{},{numberId:e.target.value})),placeholder:"123456789012345",className:"form-input"}),(0,j.jsx)("button",{type:"button",onClick:()=>k("META_NUMBER_ID","Phone Number ID"),className:"btn-history",title:"Ver hist\xf3rico",children:(0,j.jsx)(d,{size:16})})]})]}),(0,j.jsxs)("div",{className:"form-group",children:[(0,j.jsx)("label",{children:"Business Account ID"}),(0,j.jsxs)("div",{className:"input-with-history",children:[(0,j.jsx)("input",{type:"text",value:m.businessId||"",onChange:e=>x((0,t.A)((0,t.A)({},m),{},{businessId:e.target.value})),placeholder:"987654321098765",className:"form-input"}),(0,j.jsx)("button",{type:"button",onClick:()=>k("META_BUSINESS_ACCOUNT_ID","Business Account ID"),className:"btn-history",title:"Ver hist\xf3rico",children:(0,j.jsx)(d,{size:16})})]})]})]}),(0,j.jsxs)("div",{className:"form-row",children:[(0,j.jsxs)("div",{className:"form-group",children:[(0,j.jsx)("label",{children:"API Version"}),(0,j.jsxs)("select",{value:m.apiVersion||"v22.0",onChange:e=>x((0,t.A)((0,t.A)({},m),{},{apiVersion:e.target.value})),className:"form-input",children:[(0,j.jsx)("option",{value:"v18.0",children:"v18.0"}),(0,j.jsx)("option",{value:"v19.0",children:"v19.0"}),(0,j.jsx)("option",{value:"v20.0",children:"v20.0"}),(0,j.jsx)("option",{value:"v21.0",children:"v21.0"}),(0,j.jsx)("option",{value:"v22.0",children:"v22.0 (Latest)"})]})]}),(0,j.jsxs)("div",{className:"form-group",children:[(0,j.jsx)("label",{children:"N\xfamero de Tel\xe9fono (para pruebas)"}),(0,j.jsx)("input",{type:"tel",value:m.phoneNumber||"",onChange:e=>x((0,t.A)((0,t.A)({},m),{},{phoneNumber:e.target.value})),placeholder:"+1xxxxxxxxxx",className:"form-input"})]})]})]}),(0,j.jsx)("div",{className:"form-actions",children:(0,j.jsxs)("div",{className:"actions-right",children:[(0,j.jsxs)("button",{type:"button",onClick:()=>{i({to:m.phoneNumber,message:"\ud83e\uddea Test desde Dashboard - "+(new Date).toLocaleString()})},disabled:!C||p,className:"btn-test",children:[(0,j.jsx)(h,{size:16}),p?"Enviando...":"Enviar Test"]}),(0,j.jsxs)("button",{type:"submit",disabled:l,className:"btn-save",children:[(0,j.jsx)(u,{size:16}),l?"Guardando...":"Guardar Configuraci\xf3n"]})]})})]}),(0,j.jsxs)("div",{className:"instructions-section",children:[(0,j.jsx)("h2",{children:"\ud83d\udcd6 Instrucciones"}),(0,j.jsxs)("ol",{className:"instructions-list",children:[(0,j.jsxs)("li",{children:["Ve a ",(0,j.jsx)("a",{href:"https://developers.facebook.com",target:"_blank",rel:"noopener noreferrer",children:"Meta Developers"})]}),(0,j.jsx)("li",{children:"Selecciona tu App de WhatsApp Business API"}),(0,j.jsx)("li",{children:'En "WhatsApp" \u2192 "Configuration", configura el Webhook URL y Verify Token'}),(0,j.jsx)("li",{children:'Copia tu Access Token desde "App Settings" \u2192 "Basic"'}),(0,j.jsx)("li",{children:"Obt\xe9n tu Phone Number ID y Business Account ID"}),(0,j.jsx)("li",{children:"P\xe9galos aqu\xed y guarda la configuraci\xf3n"}),(0,j.jsx)("li",{children:"Haz una prueba enviando un mensaje de test"})]})]}),f&&(0,j.jsx)(y,{fieldKey:f.key,fieldLabel:f.label,isOpen:b,onClose:()=>{A(!1),g(null)},onRestore:e=>{if(f){const s={META_JWT_TOKEN:"jwtToken",META_NUMBER_ID:"numberId",META_BUSINESS_ACCOUNT_ID:"businessId",META_VERIFY_TOKEN:"verifyToken",META_API_VERSION:"apiVersion",PHONE_NUMBER:"phoneNumber"}[f.key]||f.key;x((0,t.A)((0,t.A)({},m),{},{[s]:e}))}}})]})}},7701:(e,s,i)=>{i.d(s,{Wz:()=>T,Vp:()=>E});var t,a,n,r,o,l=i(3248),c=i(2532),d=i(2555),h=i(5043),u=i(9790),v=i(5149),p=i(8458),m=i(6562),x=i(4558),j=i(5239),y=i(1454),b=i(329),A=i(9723),f=(t=new WeakMap,a=new WeakMap,n=new WeakMap,r=new WeakMap,o=new WeakSet,class extends b.Q{constructor(e,s){super(),(0,u.A)(this,o),(0,v.A)(this,t,void 0),(0,v.A)(this,a,void 0),(0,v.A)(this,n,void 0),(0,v.A)(this,r,void 0),(0,x.A)(t,this,e),this.setOptions(s),this.bindMethods(),(0,m.A)(o,this,g).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){var s;const i=this.options;this.options=(0,p.A)(t,this).defaultMutationOptions(e),(0,A.f8)(this.options,i)||(0,p.A)(t,this).getMutationCache().notify({type:"observerOptionsUpdated",mutation:(0,p.A)(n,this),observer:this}),null!==i&&void 0!==i&&i.mutationKey&&this.options.mutationKey&&(0,A.EN)(i.mutationKey)!==(0,A.EN)(this.options.mutationKey)?this.reset():"pending"===(null===(s=(0,p.A)(n,this))||void 0===s?void 0:s.state.status)&&(0,p.A)(n,this).setOptions(this.options)}onUnsubscribe(){var e;this.hasListeners()||(null===(e=(0,p.A)(n,this))||void 0===e||e.removeObserver(this))}onMutationUpdate(e){(0,m.A)(o,this,g).call(this),(0,m.A)(o,this,N).call(this,e)}getCurrentResult(){return(0,p.A)(a,this)}reset(){var e;null===(e=(0,p.A)(n,this))||void 0===e||e.removeObserver(this),(0,x.A)(n,this,void 0),(0,m.A)(o,this,g).call(this),(0,m.A)(o,this,N).call(this)}mutate(e,s){var i;return(0,x.A)(r,this,s),null===(i=(0,p.A)(n,this))||void 0===i||i.removeObserver(this),(0,x.A)(n,this,(0,p.A)(t,this).getMutationCache().build((0,p.A)(t,this),this.options)),(0,p.A)(n,this).addObserver(this),(0,p.A)(n,this).execute(e)}});function g(){var e,s;const i=null!==(e=null===(s=(0,p.A)(n,this))||void 0===s?void 0:s.state)&&void 0!==e?e:(0,j.$)();(0,x.A)(a,this,(0,d.A)((0,d.A)({},i),{},{isPending:"pending"===i.status,isSuccess:"success"===i.status,isError:"error"===i.status,isIdle:"idle"===i.status,mutate:this.mutate,reset:this.reset}))}function N(e){y.jG.batch(()=>{if((0,p.A)(r,this)&&this.hasListeners()){const u=(0,p.A)(a,this).variables,v=(0,p.A)(a,this).context,m={client:(0,p.A)(t,this),meta:this.options.meta,mutationKey:this.options.mutationKey};var s,i,n,o;if("success"===(null===e||void 0===e?void 0:e.type))null===(s=(i=(0,p.A)(r,this)).onSuccess)||void 0===s||s.call(i,e.data,u,v,m),null===(n=(o=(0,p.A)(r,this)).onSettled)||void 0===n||n.call(o,e.data,null,u,v,m);else if("error"===(null===e||void 0===e?void 0:e.type)){var l,c,d,h;null===(l=(c=(0,p.A)(r,this)).onError)||void 0===l||l.call(c,e.error,u,v,m),null===(d=(h=(0,p.A)(r,this)).onSettled)||void 0===d||d.call(h,void 0,e.error,u,v,m)}}this.listeners.forEach(e=>{e((0,p.A)(a,this))})})}function k(e,s){const i=(0,l.jE)(s),[t]=h.useState(()=>new f(i,e));h.useEffect(()=>{t.setOptions(e)},[t,e]);const a=h.useSyncExternalStore(h.useCallback(e=>t.subscribe(y.jG.batchCalls(e)),[t]),()=>t.getCurrentResult(),()=>t.getCurrentResult()),n=h.useCallback((e,s)=>{t.mutate(e,s).catch(A.lQ)},[t]);if(a.error&&(0,A.GU)(t.options.throwOnError,[a.error]))throw a.error;return(0,d.A)((0,d.A)({},a),{},{mutate:n,mutateAsync:a.mutate})}var C=i(6305),M=i(3768);function E(){const e=(0,l.jE)(),{data:s,isLoading:i,error:t}=(0,c.I)({queryKey:["meta-config"],queryFn:C.O.getConfig,staleTime:3e4}),a=k({mutationFn:C.O.saveConfig,onSuccess:()=>{e.invalidateQueries(["meta-config"]),M.Ay.success("\u2705 Configuraci\xf3n guardada")},onError:e=>{var s,i;M.Ay.error((null===(s=e.response)||void 0===s||null===(i=s.data)||void 0===i?void 0:i.error)||"Error guardando configuraci\xf3n")}}),n=k({mutationFn:C.O.testMessage,onSuccess:()=>{M.Ay.success("\u2705 Mensaje de prueba enviado")},onError:e=>{var s,i;M.Ay.error((null===(s=e.response)||void 0===s||null===(i=s.data)||void 0===i?void 0:i.error)||"Error enviando test")}});return{config:s,isLoading:i,error:t,saveConfig:a.mutate,testMessage:n.mutate,isSaving:a.isPending,isTesting:n.isPending}}function T(){return(0,c.I)({queryKey:["health"],queryFn:C.HN.getHealth,refetchInterval:3e4,staleTime:1e4})}},9875:(e,s,i)=>{i.d(s,{A:()=>t});const t=(0,i(8995).A)("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])}}]);
//# sourceMappingURL=453.40e7afd0.chunk.js.map