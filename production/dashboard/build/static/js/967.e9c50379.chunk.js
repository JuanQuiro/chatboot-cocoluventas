"use strict";(self.webpackChunkcocolu_dashboard=self.webpackChunkcocolu_dashboard||[]).push([[967],{9967:(e,t,a)=>{a.r(t),a.d(t,{default:()=>$});var n,r=a(5043),i=a(108),s=a(8420),o=a(8387),c=a(1744),l=a(1629),d=a.n(l),u=a(539),p=a.n(u),h=a(9686),m=a.n(h),v=a(5268),y=a.n(v),f=a(9853),x=a.n(f),b=a(8471),j=a(8892),g=a(1639),k=a(1519),N=a(6015),A=a(6307),O=a(202),P=a(240),w=["layout","type","stroke","connectNulls","isRange","ref"],E=["key"];function S(e){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S(e)}function D(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;a[n]=e[n]}return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}function M(){return M=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},M.apply(this,arguments)}function _(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function I(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?_(Object(a),!0).forEach(function(t){W(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):_(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function C(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,V(n.key),n)}}function L(e,t,a){return t=R(t),function(e,t){if(t&&("object"===S(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,B()?Reflect.construct(t,a||[],R(e).constructor):t.apply(e,a))}function B(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(B=function(){return!!e})()}function R(e){return R=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},R(e)}function T(e,t){return T=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},T(e,t)}function W(e,t,a){return(t=V(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function V(e){var t=function(e,t){if("object"!=S(e)||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!=S(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==S(t)?t:t+""}var z=function(e){function t(){var e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return W(e=L(this,t,[].concat(n)),"state",{isAnimationFinished:!0}),W(e,"id",(0,A.NF)("recharts-area-")),W(e,"handleAnimationEnd",function(){var t=e.props.onAnimationEnd;e.setState({isAnimationFinished:!0}),d()(t)&&t()}),W(e,"handleAnimationStart",function(){var t=e.props.onAnimationStart;e.setState({isAnimationFinished:!1}),d()(t)&&t()}),e}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&T(e,t)}(t,e),a=t,i=[{key:"getDerivedStateFromProps",value:function(e,t){return e.animationId!==t.prevAnimationId?{prevAnimationId:e.animationId,curPoints:e.points,curBaseLine:e.baseLine,prevPoints:t.curPoints,prevBaseLine:t.curBaseLine}:e.points!==t.curPoints||e.baseLine!==t.curBaseLine?{curPoints:e.points,curBaseLine:e.baseLine}:null}}],(n=[{key:"renderDots",value:function(e,a,n){var i=this.props.isAnimationActive,s=this.state.isAnimationFinished;if(i&&!s)return null;var o=this.props,c=o.dot,l=o.points,d=o.dataKey,u=(0,P.J9)(this.props,!1),p=(0,P.J9)(c,!0),h=l.map(function(e,a){var n=I(I(I({key:"dot-".concat(a),r:3},u),p),{},{index:a,cx:e.x,cy:e.y,dataKey:d,value:e.value,payload:e.payload,points:l});return t.renderDotItem(c,n)}),m={clipPath:e?"url(#clipPath-".concat(a?"":"dots-").concat(n,")"):null};return r.createElement(g.W,M({className:"recharts-area-dots"},m),h)}},{key:"renderHorizontalRect",value:function(e){var t=this.props,a=t.baseLine,n=t.points,i=t.strokeWidth,s=n[0].x,o=n[n.length-1].x,c=e*Math.abs(s-o),l=p()(n.map(function(e){return e.y||0}));return(0,A.Et)(a)&&"number"===typeof a?l=Math.max(a,l):a&&Array.isArray(a)&&a.length&&(l=Math.max(p()(a.map(function(e){return e.y||0})),l)),(0,A.Et)(l)?r.createElement("rect",{x:s<o?s:s-c,y:0,width:c,height:Math.floor(l+(i?parseInt("".concat(i),10):1))}):null}},{key:"renderVerticalRect",value:function(e){var t=this.props,a=t.baseLine,n=t.points,i=t.strokeWidth,s=n[0].y,o=n[n.length-1].y,c=e*Math.abs(s-o),l=p()(n.map(function(e){return e.x||0}));return(0,A.Et)(a)&&"number"===typeof a?l=Math.max(a,l):a&&Array.isArray(a)&&a.length&&(l=Math.max(p()(a.map(function(e){return e.x||0})),l)),(0,A.Et)(l)?r.createElement("rect",{x:0,y:s<o?s:s-c,width:l+(i?parseInt("".concat(i),10):1),height:Math.floor(c)}):null}},{key:"renderClipRect",value:function(e){return"vertical"===this.props.layout?this.renderVerticalRect(e):this.renderHorizontalRect(e)}},{key:"renderAreaStatically",value:function(e,t,a,n){var i=this.props,s=i.layout,o=i.type,c=i.stroke,l=i.connectNulls,d=i.isRange,u=(i.ref,D(i,w));return r.createElement(g.W,{clipPath:a?"url(#clipPath-".concat(n,")"):null},r.createElement(b.I,M({},(0,P.J9)(u,!0),{points:e,connectNulls:l,type:o,baseLine:t,layout:s,stroke:"none",className:"recharts-area-area"})),"none"!==c&&r.createElement(b.I,M({},(0,P.J9)(this.props,!1),{className:"recharts-area-curve",layout:s,type:o,connectNulls:l,fill:"none",points:e})),"none"!==c&&d&&r.createElement(b.I,M({},(0,P.J9)(this.props,!1),{className:"recharts-area-curve",layout:s,type:o,connectNulls:l,fill:"none",points:t})))}},{key:"renderAreaWithAnimation",value:function(e,t){var a=this,n=this.props,i=n.points,s=n.baseLine,o=n.isAnimationActive,l=n.animationBegin,d=n.animationDuration,u=n.animationEasing,p=n.animationId,h=this.state,v=h.prevPoints,f=h.prevBaseLine;return r.createElement(c.Ay,{begin:l,duration:d,isActive:o,easing:u,from:{t:0},to:{t:1},key:"area-".concat(p),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(n){var o=n.t;if(v){var c,l=v.length/i.length,d=i.map(function(e,t){var a=Math.floor(t*l);if(v[a]){var n=v[a],r=(0,A.Dj)(n.x,e.x),i=(0,A.Dj)(n.y,e.y);return I(I({},e),{},{x:r(o),y:i(o)})}return e});return c=(0,A.Et)(s)&&"number"===typeof s?(0,A.Dj)(f,s)(o):m()(s)||y()(s)?(0,A.Dj)(f,0)(o):s.map(function(e,t){var a=Math.floor(t*l);if(f[a]){var n=f[a],r=(0,A.Dj)(n.x,e.x),i=(0,A.Dj)(n.y,e.y);return I(I({},e),{},{x:r(o),y:i(o)})}return e}),a.renderAreaStatically(d,c,e,t)}return r.createElement(g.W,null,r.createElement("defs",null,r.createElement("clipPath",{id:"animationClipPath-".concat(t)},a.renderClipRect(o))),r.createElement(g.W,{clipPath:"url(#animationClipPath-".concat(t,")")},a.renderAreaStatically(i,s,e,t)))})}},{key:"renderArea",value:function(e,t){var a=this.props,n=a.points,r=a.baseLine,i=a.isAnimationActive,s=this.state,o=s.prevPoints,c=s.prevBaseLine,l=s.totalLength;return i&&n&&n.length&&(!o&&l>0||!x()(o,n)||!x()(c,r))?this.renderAreaWithAnimation(e,t):this.renderAreaStatically(n,r,e,t)}},{key:"render",value:function(){var e,t=this.props,a=t.hide,n=t.dot,i=t.points,s=t.className,c=t.top,l=t.left,d=t.xAxis,u=t.yAxis,p=t.width,h=t.height,v=t.isAnimationActive,y=t.id;if(a||!i||!i.length)return null;var f=this.state.isAnimationFinished,x=1===i.length,b=(0,o.A)("recharts-area",s),j=d&&d.allowDataOverflow,N=u&&u.allowDataOverflow,A=j||N,O=m()(y)?this.id:y,w=null!==(e=(0,P.J9)(n,!1))&&void 0!==e?e:{r:3,strokeWidth:2},E=w.r,S=void 0===E?3:E,D=w.strokeWidth,M=void 0===D?2:D,_=((0,P.sT)(n)?n:{}).clipDot,I=void 0===_||_,C=2*S+M;return r.createElement(g.W,{className:b},j||N?r.createElement("defs",null,r.createElement("clipPath",{id:"clipPath-".concat(O)},r.createElement("rect",{x:j?l:l-p/2,y:N?c:c-h/2,width:j?p:2*p,height:N?h:2*h})),!I&&r.createElement("clipPath",{id:"clipPath-dots-".concat(O)},r.createElement("rect",{x:l-C/2,y:c-C/2,width:p+C,height:h+C}))):null,x?null:this.renderArea(A,O),(n||x)&&this.renderDots(A,I,O),(!v||f)&&k.Z.renderCallByParent(this.props,i))}}])&&C(a.prototype,n),i&&C(a,i),Object.defineProperty(a,"prototype",{writable:!1}),a;var a,n,i}(r.PureComponent);n=z,W(z,"displayName","Area"),W(z,"defaultProps",{stroke:"#3182bd",fill:"#3182bd",fillOpacity:.6,xAxisId:0,yAxisId:0,legendType:"line",connectNulls:!1,points:[],dot:!1,activeDot:!0,hide:!1,isAnimationActive:!N.m.isSsr,animationBegin:0,animationDuration:1500,animationEasing:"ease"}),W(z,"getBaseValue",function(e,t,a,n){var r=e.layout,i=e.baseValue,s=t.props.baseValue,o=null!==s&&void 0!==s?s:i;if((0,A.Et)(o)&&"number"===typeof o)return o;var c="horizontal"===r?n:a,l=c.scale.domain();if("number"===c.type){var d=Math.max(l[0],l[1]),u=Math.min(l[0],l[1]);return"dataMin"===o?u:"dataMax"===o||d<0?d:Math.max(Math.min(l[0],l[1]),0)}return"dataMin"===o?l[0]:"dataMax"===o?l[1]:l[0]}),W(z,"getComposedData",function(e){var t,a=e.props,r=e.item,i=e.xAxis,s=e.yAxis,o=e.xAxisTicks,c=e.yAxisTicks,l=e.bandSize,d=e.dataKey,u=e.stackedData,p=e.dataStartIndex,h=e.displayedData,m=e.offset,v=a.layout,y=u&&u.length,f=n.getBaseValue(a,r,i,s),x="horizontal"===v,b=!1,j=h.map(function(e,t){var a;y?a=u[p+t]:(a=(0,O.kr)(e,d),Array.isArray(a)?b=!0:a=[f,a]);var n=null==a[1]||y&&null==(0,O.kr)(e,d);return x?{x:(0,O.nb)({axis:i,ticks:o,bandSize:l,entry:e,index:t}),y:n?null:s.scale(a[1]),value:a,payload:e}:{x:n?null:i.scale(a[1]),y:(0,O.nb)({axis:s,ticks:c,bandSize:l,entry:e,index:t}),value:a,payload:e}});return t=y||b?j.map(function(e){var t=Array.isArray(e.value)?e.value[0]:null;return x?{x:e.x,y:null!=t&&null!=e.y?s.scale(t):null}:{x:null!=t?i.scale(t):null,y:e.y}}):x?s.scale(f):i.scale(f),I({points:j,baseLine:t,layout:v,isRange:b},m)}),W(z,"renderDotItem",function(e,t){var a;if(r.isValidElement(e))a=r.cloneElement(e,t);else if(d()(e))a=e(t);else{var n=(0,o.A)("recharts-area-dot","boolean"!==typeof e?e.className:""),i=t.key,s=D(t,E);a=r.createElement(j.c,M({},s,{key:i,className:n}))}return a});var F=a(2185),K=a(6026),J=a(3831),H=(0,s.gu)({chartName:"AreaChart",GraphicalChild:z,axisComponents:[{axisType:"xAxis",AxisComp:F.W},{axisType:"yAxis",AxisComp:K.h}],formatAxisMap:J.pr}),q=a(7734),U=a(6150),G=a(2291),Z=a(8643),Q=a(579);const X=e=>({message:"\ud83d\udcac",product_view:"\ud83d\udc41\ufe0f",product_search:"\ud83d\udd0d",order_completed:"\u2705",cart_abandoned:"\ud83d\uded2",support_ticket:"\ud83c\udfab",conversation_started:"\ud83c\udd95"}[e]||"\ud83d\udccc"),Y=e=>({message:"Nuevo mensaje",product_view:"Producto visto",product_search:"B\xfasqueda realizada",order_completed:"Pedido completado",cart_abandoned:"Carrito abandonado",support_ticket:"Ticket de soporte",conversation_started:"Nueva conversaci\xf3n"}[e]||e),$=()=>{const[e,t]=(0,r.useState)(null),[a,n]=(0,r.useState)([]),[s,o]=(0,r.useState)(!0),c=(0,r.useCallback)(async()=>{if(localStorage.getItem("token"))try{const[e,a]=await Promise.all([fetch("/api/analytics/metrics"),fetch("/api/analytics/events?limit=20")]),r=await e.json(),i=await a.json();r.success&&t(r.data),i.success&&n(i.data),o(!1)}catch(e){localStorage.getItem("token")&&console.error("Error fetching analytics:",e),o(!1)}else o(!1)},[]);if((0,r.useEffect)(()=>{if(!localStorage.getItem("token"))return;c();const e=setInterval(c,5e3);return()=>clearInterval(e)},[c]),s||!e)return(0,Q.jsx)("div",{className:"loading",children:"Cargando analytics..."});const l=e.messagesByHour.map((e,t)=>({hour:"".concat(t,":00"),messages:e})),d=e.productSearches.slice(0,5),u=e.productViews.slice(0,5);return(0,Q.jsxs)("div",{className:"analytics-page",children:[(0,Q.jsxs)("div",{className:"page-header",children:[(0,Q.jsx)("h2",{children:"\ud83d\udcc8 Analytics y M\xe9tricas"}),(0,Q.jsx)("p",{children:"Monitoreo en tiempo real del chatbot"})]}),(0,Q.jsxs)("div",{className:"kpis-grid",children:[(0,Q.jsxs)("div",{className:"kpi-card",children:[(0,Q.jsx)("div",{className:"kpi-icon",children:"\ud83d\udcac"}),(0,Q.jsxs)("div",{className:"kpi-content",children:[(0,Q.jsx)("div",{className:"kpi-label",children:"Total Mensajes"}),(0,Q.jsx)("div",{className:"kpi-value",children:e.totalMessages.toLocaleString()}),(0,Q.jsxs)("div",{className:"kpi-sub",children:["\u2191 ",e.incomingMessages," recibidos \xb7 \u2193 ",e.outgoingMessages," enviados"]})]})]}),(0,Q.jsxs)("div",{className:"kpi-card",children:[(0,Q.jsx)("div",{className:"kpi-icon",children:"\ud83d\udc65"}),(0,Q.jsxs)("div",{className:"kpi-content",children:[(0,Q.jsx)("div",{className:"kpi-label",children:"Usuarios"}),(0,Q.jsx)("div",{className:"kpi-value",children:e.uniqueUsers}),(0,Q.jsxs)("div",{className:"kpi-sub",children:["\ud83d\udfe2 ",e.activeUsers," activos ahora"]})]})]}),(0,Q.jsxs)("div",{className:"kpi-card",children:[(0,Q.jsx)("div",{className:"kpi-icon",children:"\ud83d\uded2"}),(0,Q.jsxs)("div",{className:"kpi-content",children:[(0,Q.jsx)("div",{className:"kpi-label",children:"Conversi\xf3n"}),(0,Q.jsxs)("div",{className:"kpi-value",children:[e.conversionRate,"%"]}),(0,Q.jsxs)("div",{className:"kpi-sub",children:[e.completedOrders," pedidos completados"]})]})]}),(0,Q.jsxs)("div",{className:"kpi-card",children:[(0,Q.jsx)("div",{className:"kpi-icon",children:"\u26a1"}),(0,Q.jsxs)("div",{className:"kpi-content",children:[(0,Q.jsx)("div",{className:"kpi-label",children:"Tiempo Respuesta"}),(0,Q.jsxs)("div",{className:"kpi-value",children:[e.averageResponseTime,"ms"]}),(0,Q.jsx)("div",{className:"kpi-sub",children:"Promedio de respuesta"})]})]})]}),(0,Q.jsxs)("div",{className:"analytics-charts",children:[(0,Q.jsxs)("div",{className:"chart-section",children:[(0,Q.jsx)("h3",{children:"\ud83d\udcca Mensajes por Hora"}),(0,Q.jsx)(i.u,{width:"100%",height:300,children:(0,Q.jsxs)(H,{data:l,children:[(0,Q.jsx)(q.d,{strokeDasharray:"3 3"}),(0,Q.jsx)(F.W,{dataKey:"hour"}),(0,Q.jsx)(K.h,{}),(0,Q.jsx)(U.m,{}),(0,Q.jsx)(z,{type:"monotone",dataKey:"messages",stroke:"#667eea",fill:"#667eea",fillOpacity:.6})]})})]}),(0,Q.jsxs)("div",{className:"analytics-row",children:[(0,Q.jsxs)("div",{className:"chart-section half",children:[(0,Q.jsx)("h3",{children:"\ud83d\udd0d Top B\xfasquedas"}),(0,Q.jsx)(i.u,{width:"100%",height:250,children:(0,Q.jsxs)(G.E,{data:d,layout:"vertical",children:[(0,Q.jsx)(q.d,{strokeDasharray:"3 3"}),(0,Q.jsx)(F.W,{type:"number"}),(0,Q.jsx)(K.h,{dataKey:"term",type:"category",width:100}),(0,Q.jsx)(U.m,{}),(0,Q.jsx)(Z.y,{dataKey:"count",fill:"#764ba2"})]})})]}),(0,Q.jsxs)("div",{className:"chart-section half",children:[(0,Q.jsx)("h3",{children:"\ud83d\udc41\ufe0f Productos M\xe1s Vistos"}),(0,Q.jsx)("div",{className:"products-list",children:u.map((e,t)=>(0,Q.jsxs)("div",{className:"product-item",children:[(0,Q.jsxs)("div",{className:"product-rank",children:["#",t+1]}),(0,Q.jsxs)("div",{className:"product-info",children:[(0,Q.jsx)("div",{className:"product-name",children:e.name}),(0,Q.jsxs)("div",{className:"product-views",children:[e.views," vistas"]})]})]},e.id))})]})]})]}),(0,Q.jsxs)("div",{className:"events-section",children:[(0,Q.jsx)("h3",{children:"\ud83d\udcdd Eventos Recientes"}),(0,Q.jsx)("div",{className:"events-list",children:a.map((e,t)=>(0,Q.jsxs)("div",{className:"event-item",children:[(0,Q.jsx)("div",{className:"event-type",children:X(e.type)}),(0,Q.jsxs)("div",{className:"event-details",children:[(0,Q.jsx)("div",{className:"event-title",children:Y(e.type)}),(0,Q.jsx)("div",{className:"event-time",children:new Date(e.timestamp).toLocaleString()})]})]},t))})]})]})}}}]);
//# sourceMappingURL=967.e9c50379.chunk.js.map