"use strict";(self.webpackChunkcocolu_dashboard=self.webpackChunkcocolu_dashboard||[]).push([[786],{570:(e,s,t)=>{t.d(s,{TZ:()=>a,Qf:()=>l,eG:()=>n});t(5043);var r=t(6456),o=t(579);const a=e=>{let{permission:s,permissions:t=[],role:a,roles:l=[],requireAll:n=!1,fallback:d=null,children:i}=e;const{hasPermission:c,hasAllPermissions:u,hasAnyPermission:m,hasRole:x}=(0,r.As)();if(a||l.length>0){if(!(a?[a]:l).some(e=>x(e)))return d}if(s)return c(s)?(0,o.jsx)(o.Fragment,{children:i}):d;if(t.length>0){if(!(n?u(t):m(t)))return d}return(0,o.jsx)(o.Fragment,{children:i})},l=e=>{let{permission:s,permissions:t=[],role:a,roles:l=[],requireAll:n=!1,fallback:d=null,unauthorizedMessage:i="No tienes permisos para ver este contenido",children:c}=e;console.log("\ud83d\udd12 [ProtectedComponent] Verificando permisos:",{permission:s,permissions:t,role:a,roles:l});const{hasPermission:u,hasAllPermissions:m,hasAnyPermission:x,hasRole:g,user:b}=(0,r.As)();if(console.log("\ud83d\udc64 [ProtectedComponent] Usuario actual:",b),console.log("\ud83d\udd11 [ProtectedComponent] Permisos del usuario:",null===b||void 0===b?void 0:b.permissions),a||l.length>0){if(!(a?[a]:l).some(e=>g(e)))return d||(0,o.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,o.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-6 max-w-md",children:(0,o.jsxs)("div",{className:"flex items-start",children:[(0,o.jsx)("div",{className:"flex-shrink-0",children:(0,o.jsx)("svg",{className:"h-6 w-6 text-yellow-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),(0,o.jsxs)("div",{className:"ml-3",children:[(0,o.jsx)("h3",{className:"text-sm font-medium text-yellow-800",children:"Acceso Restringido"}),(0,o.jsx)("div",{className:"mt-2 text-sm text-yellow-700",children:(0,o.jsx)("p",{children:i})})]})]})})})}if(s){const e=u(s);if(console.log('\ud83d\udd10 [ProtectedComponent] Verificando permiso \xfanico "'.concat(s,'": ').concat(e?"\u2705 PERMITIDO":"\u274c DENEGADO")),!e)return console.error("\ud83d\udeab [ProtectedComponent] ACCESO DENEGADO - Permiso requerido: ".concat(s)),d||(0,o.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,o.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 max-w-md",children:(0,o.jsxs)("div",{className:"flex items-start",children:[(0,o.jsx)("div",{className:"flex-shrink-0",children:(0,o.jsx)("svg",{className:"h-6 w-6 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"})})}),(0,o.jsxs)("div",{className:"ml-3",children:[(0,o.jsx)("h3",{className:"text-sm font-medium text-red-800",children:"Sin Permisos"}),(0,o.jsxs)("div",{className:"mt-2 text-sm text-red-700",children:[(0,o.jsx)("p",{children:i}),(0,o.jsxs)("p",{className:"mt-1 text-xs",children:["Permiso requerido: ",(0,o.jsx)("code",{className:"bg-red-100 px-1 rounded",children:s})]})]})]})]})})})}if(t.length>0){if(!(n?m(t):x(t)))return d||(0,o.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,o.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6 max-w-md",children:(0,o.jsxs)("div",{className:"flex items-start",children:[(0,o.jsx)("div",{className:"flex-shrink-0",children:(0,o.jsx)("svg",{className:"h-6 w-6 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,o.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),(0,o.jsxs)("div",{className:"ml-3",children:[(0,o.jsx)("h3",{className:"text-sm font-medium text-red-800",children:"Permisos Insuficientes"}),(0,o.jsxs)("div",{className:"mt-2 text-sm text-red-700",children:[(0,o.jsx)("p",{children:i}),(0,o.jsxs)("p",{className:"mt-1 text-xs",children:["Se requiere",n?"n todos":" al menos uno de"," los permisos"]})]})]})]})})})}return console.log("\u2705 [ProtectedComponent] Acceso permitido - Renderizando children"),(0,o.jsx)(o.Fragment,{children:c})},n=e=>{let{role:s,size:t="md",showIcon:r=!0}=e;const a={owner:{label:"Owner",color:"bg-purple-100 text-purple-800 border-purple-200",icon:"\ud83d\udc51"},admin:{label:"Admin",color:"bg-blue-100 text-blue-800 border-blue-200",icon:"\ud83d\udee1\ufe0f"},manager:{label:"Gerente",color:"bg-green-100 text-green-800 border-green-200",icon:"\ud83d\udcca"},agent:{label:"Agente",color:"bg-yellow-100 text-yellow-800 border-yellow-200",icon:"\ud83d\udc64"},viewer:{label:"Viewer",color:"bg-gray-100 text-gray-800 border-gray-200",icon:"\ud83d\udc41\ufe0f"},super_admin:{label:"Super Admin",color:"bg-red-100 text-red-800 border-red-200",icon:"\u26a1"}}[s]||{label:s,color:"bg-gray-100 text-gray-800 border-gray-200",icon:"\u2022"};return(0,o.jsxs)("span",{className:"inline-flex items-center gap-1 rounded-full border font-medium ".concat(a.color," ").concat({sm:"text-xs px-2 py-0.5",md:"text-sm px-2.5 py-1",lg:"text-base px-3 py-1.5"}[t]),children:[r&&(0,o.jsx)("span",{children:a.icon}),(0,o.jsx)("span",{children:a.label})]})}},4786:(e,s,t)=>{t.r(s),t.d(s,{default:()=>b});var r=t(5043),o=t(2555),a=t(570),l=t(1614),n=t(6305);const d=new class{async getBots(){try{const e=await n.Ay.get("/bots");return{success:!0,bots:e.data.bots||[],count:e.data.count||0}}catch(e){return this.getMockBots()}}getMockBots(){return{success:!0,bots:[{botId:"bot_principal_cocolu",name:"Bot Principal Cocolu",adapter:"baileys",status:"connected",phoneNumber:"+1234567890",tenantId:"cocolu",flows:9,messagesCount:1234,conversationsCount:156,connectedAt:(new Date).toISOString()}],count:1}}async getBot(e){try{return{success:!0,bot:(await n.Ay.get("/bots/".concat(e))).data.bot}}catch(r){var s,t;return{success:!1,error:(null===(s=r.response)||void 0===s||null===(t=s.data)||void 0===t?void 0:t.message)||"Error al obtener bot"}}}async getQRCode(e){try{return{success:!0,qr:(await n.Ay.get("/bots/".concat(e,"/qr"))).data.qr}}catch(r){var s,t;return{success:!1,error:(null===(s=r.response)||void 0===s||null===(t=s.data)||void 0===t?void 0:t.message)||"QR no disponible"}}}async getStats(){try{return{success:!0,stats:(await n.Ay.get("/bots/stats")).data.stats}}catch(e){return{success:!0,stats:{total:1,connected:1,disconnected:0,error:0,totalMessages:1234,totalConversations:156}}}}async createBot(e){try{return{success:!0,botId:(await n.Ay.post("/bots",e)).data.botId}}catch(r){var s,t;return{success:!1,error:(null===(s=r.response)||void 0===s||null===(t=s.data)||void 0===t?void 0:t.message)||"Error al crear bot"}}}async startBot(e){try{return{success:!0,message:(await n.Ay.post("/bots/".concat(e,"/start"))).data.message}}catch(r){var s,t;return{success:!1,error:(null===(s=r.response)||void 0===s||null===(t=s.data)||void 0===t?void 0:t.message)||"Error al iniciar bot"}}}async stopBot(e){try{return{success:!0,message:(await n.Ay.post("/bots/".concat(e,"/stop"))).data.message}}catch(r){var s,t;return{success:!1,error:(null===(s=r.response)||void 0===s||null===(t=s.data)||void 0===t?void 0:t.message)||"Error al detener bot"}}}async restartBot(e){try{return{success:!0,message:(await n.Ay.post("/bots/".concat(e,"/restart"))).data.message}}catch(r){var s,t;return{success:!1,error:(null===(s=r.response)||void 0===s||null===(t=s.data)||void 0===t?void 0:t.message)||"Error al reiniciar bot"}}}async sendMessage(e,s,t){try{return{success:!0,message:(await n.Ay.post("/bots/".concat(e,"/message"),{to:s,message:t})).data.message}}catch(a){var r,o;return{success:!1,error:(null===(r=a.response)||void 0===r||null===(o=r.data)||void 0===o?void 0:o.message)||"Error al enviar mensaje"}}}async deleteBot(e){try{return{success:!0,message:(await n.Ay.delete("/bots/".concat(e))).data.message}}catch(r){var s,t;return{success:!1,error:(null===(s=r.response)||void 0===s||null===(t=s.data)||void 0===t?void 0:t.message)||"Error al eliminar bot"}}}getStatusLabel(e){return{registered:"Registrado",starting:"Iniciando",connecting:"Conectando",qr_ready:"QR Listo",connected:"Conectado",disconnected:"Desconectado",stopped:"Detenido",error:"Error",failed:"Fallido"}[e]||e}getStatusColor(e){return{registered:"gray",starting:"blue",connecting:"blue",qr_ready:"yellow",connected:"green",disconnected:"red",stopped:"gray",error:"red",failed:"red"}[e]||"gray"}formatUptime(e){if(!e)return"0s";const s=Math.floor(e/1e3),t=Math.floor(s/60),r=Math.floor(t/60),o=Math.floor(r/24);return o>0?"".concat(o,"d ").concat(r%24,"h"):r>0?"".concat(r,"h ").concat(t%60,"m"):t>0?"".concat(t,"m ").concat(s%60,"s"):"".concat(s,"s")}};var i=t(579);const c=e=>{var s,t,r,o;let{bot:n,qrCode:c,onStart:u,onStop:m,onRestart:x,onDelete:g,getStatusBadge:b}=e;return(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow-lg overflow-hidden hover:shadow-xl transition-shadow",children:[(0,i.jsx)("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-4 text-white",children:(0,i.jsxs)("div",{className:"flex justify-between items-start",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-lg font-bold",children:n.name}),(0,i.jsx)("p",{className:"text-sm opacity-90",children:n.phoneNumber||"Sin n\xfamero"})]}),(0,i.jsxs)("div",{className:"bg-white bg-opacity-20 px-3 py-1 rounded-full text-xs font-semibold flex items-center gap-1",children:["meta"===n.adapter&&"\ud83c\udfe2","twilio"===n.adapter&&"\ud83d\udcde",["baileys","venom","wppconnect"].includes(n.adapter)&&"\ud83c\udd93",n.adapter.toUpperCase()]})]})}),(0,i.jsxs)("div",{className:"p-4",children:[(0,i.jsx)("div",{className:"mb-4",children:b(n.status)}),"qr_ready"===n.status&&c&&(0,i.jsxs)("div",{className:"mb-4 p-4 bg-yellow-50 border-2 border-yellow-200 rounded-lg text-center",children:[(0,i.jsx)("p",{className:"text-sm text-yellow-800 font-semibold mb-2",children:"\ud83d\udcf1 Escanea para conectar"}),(0,i.jsx)("div",{className:"bg-white p-3 rounded-lg inline-block",children:(0,i.jsx)(l.Ay,{value:c,size:180})}),(0,i.jsx)("p",{className:"text-xs text-yellow-700 mt-2",children:"Escanea este c\xf3digo con WhatsApp"})]}),(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[(0,i.jsxs)("div",{className:"bg-gray-50 p-3 rounded-lg",children:[(0,i.jsx)("div",{className:"text-xs text-gray-600",children:"Recibidos"}),(0,i.jsx)("div",{className:"text-lg font-bold text-gray-900",children:(null===(s=n.stats)||void 0===s?void 0:s.messagesReceived)||0})]}),(0,i.jsxs)("div",{className:"bg-gray-50 p-3 rounded-lg",children:[(0,i.jsx)("div",{className:"text-xs text-gray-600",children:"Enviados"}),(0,i.jsx)("div",{className:"text-lg font-bold text-gray-900",children:(null===(t=n.stats)||void 0===t?void 0:t.messagesSent)||0})]}),(0,i.jsxs)("div",{className:"bg-gray-50 p-3 rounded-lg",children:[(0,i.jsx)("div",{className:"text-xs text-gray-600",children:"Uptime"}),(0,i.jsx)("div",{className:"text-sm font-bold text-gray-900",children:d.formatUptime(null===(r=n.stats)||void 0===r?void 0:r.uptime)})]}),(0,i.jsxs)("div",{className:"bg-gray-50 p-3 rounded-lg",children:[(0,i.jsx)("div",{className:"text-xs text-gray-600",children:"Errores"}),(0,i.jsx)("div",{className:"text-lg font-bold text-red-600",children:(null===(o=n.stats)||void 0===o?void 0:o.errors)||0})]})]}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsx)(a.TZ,{permission:"bots.manage",children:n.isRunning?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("button",{onClick:()=>x(n.botId),className:"flex-1 bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-lg font-semibold text-sm transition-colors",children:"\ud83d\udd04 Reiniciar"}),(0,i.jsx)("button",{onClick:()=>m(n.botId),className:"flex-1 bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-semibold text-sm transition-colors",children:"\u23f9\ufe0f Detener"})]}):(0,i.jsx)("button",{onClick:()=>u(n.botId),className:"flex-1 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-semibold text-sm transition-colors",children:"\u25b6\ufe0f Iniciar"})}),(0,i.jsx)(a.TZ,{permission:"bots.delete",children:(0,i.jsx)("button",{onClick:()=>g(n.botId),className:"bg-gray-200 hover:bg-gray-300 text-gray-700 px-3 py-2 rounded-lg text-sm transition-colors",title:"Eliminar bot",children:"\ud83d\uddd1\ufe0f"})})]})]})]})},u=e=>{let{onClose:s,onSuccess:t}=e;const[a,l]=(0,r.useState)({name:"",adapter:"baileys",phoneNumber:"",webhookUrl:"",autoReconnect:!0,metaJwtToken:"",metaNumberId:"",metaVerifyToken:"",metaVersion:"v18.0",twilioAccountSid:"",twilioAuthToken:"",twilioVendorNumber:"",twilioPublicUrl:""}),[n,c]=(0,r.useState)(!1),[u,m]=(0,r.useState)("");return(0,i.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full",children:[(0,i.jsxs)("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-6 rounded-t-lg",children:[(0,i.jsx)("h2",{className:"text-2xl font-bold text-white",children:"\ud83e\udd16 Crear Nuevo Bot"}),(0,i.jsx)("p",{className:"text-white opacity-90 text-sm mt-1",children:"Configura un nuevo chatbot de WhatsApp"})]}),(0,i.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),m(""),!a.name)return void m("El nombre es requerido");c(!0);const s=await d.createBot(a);c(!1),s.success?(alert("Bot creado exitosamente"),t()):m(s.error)},className:"p-6",children:[u&&(0,i.jsx)("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:u}),(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nombre del Bot *"}),(0,i.jsx)("input",{type:"text",value:a.name,onChange:e=>l((0,o.A)((0,o.A)({},a),{},{name:e.target.value})),placeholder:"Ej: Bot Ventas Principal",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Provider (BuilderBot)"}),(0,i.jsxs)("select",{value:a.adapter,onChange:e=>l((0,o.A)((0,o.A)({},a),{},{adapter:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,i.jsxs)("optgroup",{label:"\ud83c\udd93 Gratis (QR Code)",children:[(0,i.jsx)("option",{value:"baileys",children:"Baileys - WhatsApp Web Multi-Device"}),(0,i.jsx)("option",{value:"venom",children:"Venom - Puppeteer WhatsApp Web"}),(0,i.jsx)("option",{value:"wppconnect",children:"WPPConnect - WhatsApp Web"})]}),(0,i.jsxs)("optgroup",{label:"\ud83d\udcb0 Pago (API Oficial)",children:[(0,i.jsx)("option",{value:"meta",children:"Meta - WhatsApp Business API"}),(0,i.jsx)("option",{value:"twilio",children:"Twilio - Twilio WhatsApp"})]})]}),(0,i.jsxs)("div",{className:"text-xs mt-2 space-y-1",children:["baileys"===a.adapter&&(0,i.jsx)("p",{className:"text-blue-600",children:"\u2705 Recomendado - M\xe1s estable, multi-device, gratis"}),"venom"===a.adapter&&(0,i.jsx)("p",{className:"text-blue-600",children:"\u2699\ufe0f Puppeteer-based, gratis, requiere m\xe1s recursos"}),"wppconnect"===a.adapter&&(0,i.jsx)("p",{className:"text-blue-600",children:"\ud83d\udd27 Alternativa a Venom, gratis, stable"}),"meta"===a.adapter&&(0,i.jsx)("p",{className:"text-purple-600",children:"\ud83c\udfe2 API Oficial de Meta, requiere cuenta Business (Pago)"}),"twilio"===a.adapter&&(0,i.jsx)("p",{className:"text-purple-600",children:"\ud83d\udcde Twilio WhatsApp API, requiere cuenta Twilio (Pago)"})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"N\xfamero de Tel\xe9fono (Opcional)"}),(0,i.jsx)("input",{type:"text",value:a.phoneNumber,onChange:e=>l((0,o.A)((0,o.A)({},a),{},{phoneNumber:e.target.value})),placeholder:"+52 123 456 7890",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Webhook URL (Opcional)"}),(0,i.jsx)("input",{type:"url",value:a.webhookUrl,onChange:e=>l((0,o.A)((0,o.A)({},a),{},{webhookUrl:e.target.value})),placeholder:"https://tu-servidor.com/webhook",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),["baileys","venom","wppconnect"].includes(a.adapter)&&(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[(0,i.jsx)("input",{type:"checkbox",id:"autoReconnect",checked:a.autoReconnect,onChange:e=>l((0,o.A)((0,o.A)({},a),{},{autoReconnect:e.target.checked})),className:"w-4 h-4 text-blue-600 rounded"}),(0,i.jsx)("label",{htmlFor:"autoReconnect",className:"text-sm text-gray-700",children:"Auto-reconexi\xf3n (Recomendado)"})]}),"meta"===a.adapter&&(0,i.jsxs)("div",{className:"space-y-4 p-4 bg-purple-50 border border-purple-200 rounded-lg",children:[(0,i.jsx)("h4",{className:"font-semibold text-purple-900",children:"\ud83d\udcf1 Credenciales de Meta (WhatsApp Business API)"}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"JWT Token *"}),(0,i.jsx)("input",{type:"text",value:a.metaJwtToken,onChange:e=>l((0,o.A)((0,o.A)({},a),{},{metaJwtToken:e.target.value})),placeholder:"Tu JWT Token de Meta",className:"w-full px-4 py-2 border border-gray-300 rounded-lg",required:!0})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Number ID *"}),(0,i.jsx)("input",{type:"text",value:a.metaNumberId,onChange:e=>l((0,o.A)((0,o.A)({},a),{},{metaNumberId:e.target.value})),placeholder:"ID del n\xfamero de WhatsApp",className:"w-full px-4 py-2 border border-gray-300 rounded-lg",required:!0})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Verify Token *"}),(0,i.jsx)("input",{type:"text",value:a.metaVerifyToken,onChange:e=>l((0,o.A)((0,o.A)({},a),{},{metaVerifyToken:e.target.value})),placeholder:"Token de verificaci\xf3n",className:"w-full px-4 py-2 border border-gray-300 rounded-lg",required:!0})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"API Version"}),(0,i.jsxs)("select",{value:a.metaVersion,onChange:e=>l((0,o.A)((0,o.A)({},a),{},{metaVersion:e.target.value})),className:"w-full px-4 py-2 border border-gray-300 rounded-lg",children:[(0,i.jsx)("option",{value:"v18.0",children:"v18.0"}),(0,i.jsx)("option",{value:"v17.0",children:"v17.0"}),(0,i.jsx)("option",{value:"v16.0",children:"v16.0"})]})]})]}),"twilio"===a.adapter&&(0,i.jsxs)("div",{className:"space-y-4 p-4 bg-purple-50 border border-purple-200 rounded-lg",children:[(0,i.jsx)("h4",{className:"font-semibold text-purple-900",children:"\ud83d\udcde Credenciales de Twilio"}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Account SID *"}),(0,i.jsx)("input",{type:"text",value:a.twilioAccountSid,onChange:e=>l((0,o.A)((0,o.A)({},a),{},{twilioAccountSid:e.target.value})),placeholder:"ACxxxxxxxxxxxxx",className:"w-full px-4 py-2 border border-gray-300 rounded-lg",required:!0})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Auth Token *"}),(0,i.jsx)("input",{type:"password",value:a.twilioAuthToken,onChange:e=>l((0,o.A)((0,o.A)({},a),{},{twilioAuthToken:e.target.value})),placeholder:"Tu Auth Token de Twilio",className:"w-full px-4 py-2 border border-gray-300 rounded-lg",required:!0})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Vendor Number *"}),(0,i.jsx)("input",{type:"text",value:a.twilioVendorNumber,onChange:e=>l((0,o.A)((0,o.A)({},a),{},{twilioVendorNumber:e.target.value})),placeholder:"+14155238886",className:"w-full px-4 py-2 border border-gray-300 rounded-lg",required:!0})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Public URL (Opcional)"}),(0,i.jsx)("input",{type:"url",value:a.twilioPublicUrl,onChange:e=>l((0,o.A)((0,o.A)({},a),{},{twilioPublicUrl:e.target.value})),placeholder:"https://tu-servidor.com",className:"w-full px-4 py-2 border border-gray-300 rounded-lg"})]})]})]}),(0,i.jsxs)("div",{className:"flex gap-3 mt-6",children:[(0,i.jsx)("button",{type:"button",onClick:s,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg text-gray-700 font-semibold hover:bg-gray-50 transition-colors",disabled:n,children:"Cancelar"}),(0,i.jsx)("button",{type:"submit",className:"flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold transition-colors disabled:opacity-50",disabled:n,children:n?"Creando...":"Crear Bot"})]})]})]})})};var m=t(8709);const x=()=>{console.log("\ud83e\udd16\ud83d\udd25 [BOTS-v2025-FINAL] Componente montando..."),m.A.log("Bots component mounted",{timestamp:(new Date).toISOString()});const[e,s]=(0,r.useState)([]),[t,l]=(0,r.useState)(null),[n,x]=(0,r.useState)(!0),[g,b]=(0,r.useState)(!1),[p,h]=(0,r.useState)({}),[v,y]=(0,r.useState)(!0),[j,f]=(0,r.useState)(null),N=(0,r.useCallback)(async function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];try{console.log("\ud83e\udd16 [BOTS] Cargando bots... showLoading:",e),e&&x(!0);const t=await d.getBots();console.log("\ud83e\udd16 [BOTS] Resultado getBots:",t),t.success?(s(t.bots),console.log("\u2705 [BOTS] Bots cargados:",t.bots.length)):(console.error("\u274c [BOTS] Error al cargar bots:",t.error),f(t.error)),e&&x(!1)}catch(j){console.error("\ud83d\udd34 [BOTS] Exception en loadBots:",j),f(j.message),e&&x(!1)}},[]),w=(0,r.useCallback)(async()=>{try{console.log("\ud83d\udcca [BOTS] Cargando estad\xedsticas...");const e=await d.getStats();console.log("\ud83d\udcca [BOTS] Resultado getStats:",e),e.success?(l(e.stats),console.log("\u2705 [BOTS] Stats cargadas:",e.stats)):console.error("\u274c [BOTS] Error al cargar stats:",e.error)}catch(j){console.error("\ud83d\udd34 [BOTS] Exception en loadStats:",j)}},[]);(0,r.useEffect)(()=>{console.log("\ud83d\udd25\ud83d\udd25\ud83d\udd25 [BOTS] ===== USEEFFECT PRINCIPAL EJECUT\xc1NDOSE ===== \ud83d\udd25\ud83d\udd25\ud83d\udd25"),m.A.log("Bots useEffect - Loading initial data",{autoRefresh:v,timestamp:(new Date).toISOString()});try{N(),w()}catch(j){console.error("\ud83d\udd34 [BOTS] Error cargando datos iniciales:",j),m.A.logError({type:"BOTS_INIT_ERROR",message:"Error loading initial data",error:j.message,stack:j.stack,timestamp:(new Date).toISOString()}),f(j.message)}let e;return v&&(console.log("\ud83d\udd25 [BOTS] ===== CONFIGURANDO AUTO-REFRESH 5s ===== \ud83d\udd25"),e=setInterval(()=>{console.log("\ud83d\udd04 [BOTS] Auto-refresh ejecut\xe1ndose..."),N(!1),w()},5e3)),()=>{console.log("\ud83e\udd16 [BOTS] useEffect cleanup..."),e&&(console.log("\ud83e\udd16 [BOTS] Limpiando interval"),clearInterval(e))}},[v,N,w]),(0,r.useEffect)(()=>{0!==e.length&&(console.log("\ud83d\udcf1 [BOTS] Verificando QR codes..."),e.forEach(async e=>{if("qr_ready"===e.status&&!p[e.botId]){console.log("\ud83d\udcf1 [BOTS] Cargando QR para bot ".concat(e.botId));const s=await d.getQRCode(e.botId);s.success&&s.qr&&h(t=>(0,o.A)((0,o.A)({},t),{},{[e.botId]:s.qr}))}}))},[e]);const A=(0,r.useCallback)(async e=>{const s=await d.startBot(e);s.success?(alert("Bot iniciado exitosamente"),N()):alert("Error: ".concat(s.error))},[N]),C=(0,r.useCallback)(async e=>{if(!window.confirm("\xbfDetener este bot?"))return;const s=await d.stopBot(e);s.success?(alert("Bot detenido"),N(),h(s=>{const t=(0,o.A)({},s);return delete t[e],t})):alert("Error: ".concat(s.error))},[N]),k=(0,r.useCallback)(async e=>{if(!window.confirm("\xbfReiniciar este bot?"))return;const s=await d.restartBot(e);s.success?(alert("Bot reiniciado"),N()):alert("Error: ".concat(s.error))},[N]),B=(0,r.useCallback)(async e=>{if(!window.confirm("\xbfEliminar este bot permanentemente?"))return;const s=await d.deleteBot(e);s.success?(alert("Bot eliminado"),N()):alert("Error: ".concat(s.error))},[N]),S=e=>{const s=d.getStatusColor(e),t=d.getStatusLabel(e);return(0,i.jsxs)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium border ".concat({green:"bg-green-100 text-green-800 border-green-200",red:"bg-red-100 text-red-800 border-red-200",yellow:"bg-yellow-100 text-yellow-800 border-yellow-200",blue:"bg-blue-100 text-blue-800 border-blue-200",gray:"bg-gray-100 text-gray-800 border-gray-200"}[s]),children:[(0,i.jsx)("span",{className:"inline-block w-2 h-2 rounded-full mr-2 ".concat("connected"===e?"bg-green-500 animate-pulse":"")}),t]})};return(0,i.jsx)(a.Qf,{permission:"bots.view",children:(0,i.jsxs)("div",{className:"p-6",children:[(0,i.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"\ud83e\udd16 Gesti\xf3n de Chatbots"}),(0,i.jsx)("p",{className:"text-gray-600 mt-1",children:"Centro de control para administrar todos los bots de WhatsApp"})]}),(0,i.jsxs)("div",{className:"flex gap-3",children:[(0,i.jsx)("button",{onClick:()=>y(!v),className:"px-4 py-2 rounded-lg font-semibold transition-colors ".concat(v?"bg-green-100 text-green-700 border-2 border-green-300":"bg-gray-100 text-gray-700 border-2 border-gray-300"),children:v?"\ud83d\udd04 Auto-Refresh ON":"\u23f8\ufe0f Auto-Refresh OFF"}),(0,i.jsx)(a.TZ,{permission:"bots.create",children:(0,i.jsxs)("button",{onClick:()=>b(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-semibold transition-colors flex items-center gap-2",children:[(0,i.jsx)("span",{children:"\u2795"}),(0,i.jsx)("span",{children:"Nuevo Bot"})]})})]})]}),t&&(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,i.jsx)("div",{className:"text-sm text-gray-600",children:"Total Bots"}),(0,i.jsx)("div",{className:"text-3xl font-bold text-gray-900 mt-2",children:t.totalBots})]}),(0,i.jsxs)("div",{className:"bg-green-50 rounded-lg shadow p-6 border-2 border-green-200",children:[(0,i.jsx)("div",{className:"text-sm text-green-600",children:"Conectados"}),(0,i.jsx)("div",{className:"text-3xl font-bold text-green-700 mt-2",children:t.connectedBots})]}),(0,i.jsxs)("div",{className:"bg-blue-50 rounded-lg shadow p-6 border-2 border-blue-200",children:[(0,i.jsx)("div",{className:"text-sm text-blue-600",children:"Mensajes"}),(0,i.jsx)("div",{className:"text-3xl font-bold text-blue-700 mt-2",children:t.totalMessages})]}),(0,i.jsxs)("div",{className:"bg-red-50 rounded-lg shadow p-6 border-2 border-red-200",children:[(0,i.jsx)("div",{className:"text-sm text-red-600",children:"Errores"}),(0,i.jsx)("div",{className:"text-3xl font-bold text-red-700 mt-2",children:t.totalErrors})]})]}),n?(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:[(0,i.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,i.jsx)("p",{className:"text-gray-600",children:"Cargando bots..."})]}):0===e.length?(0,i.jsxs)("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:[(0,i.jsx)("div",{className:"text-6xl mb-4",children:"\ud83e\udd16"}),(0,i.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No hay bots registrados"}),(0,i.jsx)("p",{className:"text-gray-600 mb-6",children:"Crea tu primer bot para comenzar a gestionar conversaciones"}),(0,i.jsx)(a.TZ,{permission:"bots.create",children:(0,i.jsx)("button",{onClick:()=>b(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold",children:"Crear Primer Bot"})})]}):(0,i.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:e.map(e=>(0,i.jsx)(c,{bot:e,qrCode:p[e.botId],onStart:A,onStop:C,onRestart:k,onDelete:B,getStatusBadge:S},e.botId))}),g&&(0,i.jsx)(u,{onClose:()=>b(!1),onSuccess:()=>{b(!1),N()}})]})})};var g=t(8307);const b=()=>{console.log("\ud83d\udee1\ufe0f [BotsWrapper] Inicializando wrapper de Bots");try{return console.log("\ud83d\udee1\ufe0f [BotsWrapper] Intentando renderizar componente Bots"),(0,i.jsx)(g.A,{children:(0,i.jsx)(x,{})})}catch(e){return console.error("\ud83d\udd34 [BotsWrapper] ERROR CR\xcdTICO al renderizar Bots:",e),(0,i.jsxs)("div",{style:{padding:"40px",textAlign:"center",background:"#fee2e2",borderRadius:"12px",margin:"20px"},children:[(0,i.jsx)("h2",{style:{color:"#991b1b"},children:"\ud83d\udd34 Error Cr\xedtico"}),(0,i.jsx)("p",{style:{color:"#7f1d1d"},children:"No se pudo cargar el componente de Bots."}),(0,i.jsx)("pre",{style:{background:"#1f2937",color:"#10b981",padding:"16px",borderRadius:"8px",textAlign:"left",overflow:"auto",marginTop:"16px"},children:null===e||void 0===e?void 0:e.toString()}),(0,i.jsx)("button",{onClick:()=>window.location.href="/",style:{marginTop:"16px",padding:"12px 24px",background:"#dc2626",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"bold"},children:"\ud83c\udfe0 Volver al Dashboard"})]})}}}}]);
//# sourceMappingURL=786.aa4b3549.chunk.js.map