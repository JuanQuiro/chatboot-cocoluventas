/*! For license information please see 261.6c0e9af6.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkcocolu_dashboard=self.webpackChunkcocolu_dashboard||[]).push([[261],{516:(e,s,a)=>{a.d(s,{A:()=>t});const t=(0,a(8995).A)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},3261:(e,s,a)=>{a.r(s),a.d(s,{default:()=>n});var t=a(5043),r=a(516),l=a(3768),i=a(579);function n(){const[e,s]=(0,t.useState)({received:[],sent:[],errors:[]}),[a,n]=(0,t.useState)(null),[c,d]=(0,t.useState)(null),[o,h]=(0,t.useState)(!0),[m,j]=(0,t.useState)(null),x=async()=>{try{const e=await fetch("/api/open/messages"),a=await e.json();a.success&&(s(a.data||{received:[],sent:[],errors:[]}),j(new Date))}catch(e){console.error("Error fetching messages:",e),l.Ay.error("Error cargando mensajes")}finally{h(!1)}};(0,t.useEffect)(()=>{x();const e=new EventSource("/api/events");return e.addEventListener("messages",e=>{try{const a=JSON.parse(e.data);s(a),j(new Date)}catch(a){console.error("Error parsing SSE:",a)}}),()=>e.close()},[]);const{inHour:v,outHour:u,errHour:N}=(()=>{const s=Date.now()-36e5;return{inHour:e.received.filter(e=>new Date(e.timestamp).getTime()>=s).length,outHour:e.sent.filter(e=>new Date(e.timestamp).getTime()>=s).length,errHour:e.errors.filter(e=>new Date(e.timestamp).getTime()>=s).length}})();return(0,i.jsxs)("div",{className:"messages-page",children:[(0,i.jsxs)("div",{className:"page-header",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{children:"\ud83d\udcac Mensajes del Bot"}),(0,i.jsx)("p",{className:"subtitle",children:"Monitor de mensajes en tiempo real"})]}),(0,i.jsxs)("div",{className:"header-actions",children:[m&&(0,i.jsxs)("span",{className:"last-update",children:["\xdaltima actualizaci\xf3n: ",m.toLocaleTimeString()]}),(0,i.jsxs)("button",{onClick:x,className:"btn-refresh",disabled:o,children:[(0,i.jsx)(r.A,{className:o?"spinning":"",size:16}),"Actualizar"]})]})]}),(0,i.jsxs)("div",{className:"stats-grid",children:[(0,i.jsxs)("div",{className:"stat-card received",children:[(0,i.jsx)("div",{className:"stat-icon",children:"\ud83d\udce5"}),(0,i.jsxs)("div",{className:"stat-content",children:[(0,i.jsx)("div",{className:"stat-label",children:"Recibidos"}),(0,i.jsx)("div",{className:"stat-value",children:e.received.length}),(0,i.jsxs)("div",{className:"stat-detail",children:["+",v," \xfaltima hora"]})]})]}),(0,i.jsxs)("div",{className:"stat-card sent",children:[(0,i.jsx)("div",{className:"stat-icon",children:"\ud83d\udce4"}),(0,i.jsxs)("div",{className:"stat-content",children:[(0,i.jsx)("div",{className:"stat-label",children:"Enviados"}),(0,i.jsx)("div",{className:"stat-value",children:e.sent.length}),(0,i.jsxs)("div",{className:"stat-detail",children:["+",u," \xfaltima hora"]})]})]}),(0,i.jsxs)("div",{className:"stat-card errors",children:[(0,i.jsx)("div",{className:"stat-icon",children:"\u26a0\ufe0f"}),(0,i.jsxs)("div",{className:"stat-content",children:[(0,i.jsx)("div",{className:"stat-label",children:"Errores"}),(0,i.jsx)("div",{className:"stat-value",children:e.errors.length}),(0,i.jsxs)("div",{className:"stat-detail",children:["+",N," \xfaltima hora"]})]})]})]}),(0,i.jsxs)("div",{className:"messages-grid",children:[(0,i.jsxs)("div",{className:"message-section",children:[(0,i.jsxs)("h2",{children:["\ud83d\udce5 Recibidos ",(0,i.jsx)("span",{className:"badge",children:e.received.length})]}),(0,i.jsx)("div",{className:"table-container",children:(0,i.jsxs)("table",{className:"messages-table",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"Hora"}),(0,i.jsx)("th",{children:"De"}),(0,i.jsx)("th",{children:"Tipo"}),(0,i.jsx)("th",{children:"Mensaje"})]})}),(0,i.jsx)("tbody",{children:e.received.slice().reverse().map((e,s)=>(0,i.jsxs)("tr",{onClick:()=>{n(e),d("received")},className:a===e?"selected":"",children:[(0,i.jsx)("td",{children:new Date(e.timestamp).toLocaleTimeString()}),(0,i.jsx)("td",{children:e.from||"-"}),(0,i.jsx)("td",{children:(0,i.jsx)("span",{className:"pill pill-in",children:"Texto"})}),(0,i.jsx)("td",{className:"text-preview",children:e.body||"-"})]},s))})]})})]}),(0,i.jsxs)("div",{className:"message-section",children:[(0,i.jsxs)("h2",{children:["\ud83d\udce4 Enviados ",(0,i.jsx)("span",{className:"badge",children:e.sent.length})]}),(0,i.jsx)("div",{className:"table-container",children:(0,i.jsxs)("table",{className:"messages-table",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"Hora"}),(0,i.jsx)("th",{children:"Para"}),(0,i.jsx)("th",{children:"Estado"}),(0,i.jsx)("th",{children:"Mensaje"})]})}),(0,i.jsx)("tbody",{children:e.sent.slice().reverse().map((e,s)=>(0,i.jsxs)("tr",{onClick:()=>{n(e),d("sent")},className:a===e?"selected":"",children:[(0,i.jsx)("td",{children:new Date(e.timestamp).toLocaleTimeString()}),(0,i.jsx)("td",{children:e.to||"-"}),(0,i.jsx)("td",{children:(0,i.jsx)("span",{className:"pill pill-out",children:e.status||"enviado"})}),(0,i.jsx)("td",{className:"text-preview",children:e.body||"-"})]},s))})]})})]}),(0,i.jsxs)("div",{className:"message-section",children:[(0,i.jsxs)("h2",{children:["\u26a0\ufe0f Errores ",(0,i.jsx)("span",{className:"badge",children:e.errors.length})]}),(0,i.jsx)("div",{className:"table-container",children:(0,i.jsxs)("table",{className:"messages-table",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"Hora"}),(0,i.jsx)("th",{children:"Contexto"}),(0,i.jsx)("th",{colSpan:"2",children:"Error"})]})}),(0,i.jsx)("tbody",{children:e.errors.slice().reverse().map((e,s)=>(0,i.jsxs)("tr",{onClick:()=>{n(e),d("errors")},className:a===e?"selected":"",children:[(0,i.jsx)("td",{children:new Date(e.timestamp).toLocaleTimeString()}),(0,i.jsx)("td",{children:e.context||"-"}),(0,i.jsx)("td",{className:"error-text",colSpan:"2",children:e.error||"-"})]},s))})]})})]})]}),a&&(0,i.jsxs)("div",{className:"message-detail",children:[(0,i.jsxs)("div",{className:"detail-header",children:[(0,i.jsxs)("h3",{children:["\ud83d\udd0d Detalle del Mensaje (",c,")"]}),(0,i.jsx)("button",{onClick:()=>n(null),className:"btn-close",children:"\xd7"})]}),(0,i.jsx)("pre",{className:"detail-content",children:JSON.stringify(a,null,2)})]})]})}},8995:(e,s,a)=>{a.d(s,{A:()=>n});var t=a(2555);var r=a(5043),l={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const i=["color","size","strokeWidth","absoluteStrokeWidth","className","children"],n=(e,s)=>{const a=(0,r.forwardRef)((a,n)=>{let{color:c="currentColor",size:d=24,strokeWidth:o=2,absoluteStrokeWidth:h,className:m="",children:j}=a,x=function(e,s){if(null==e)return{};var a,t,r=function(e,s){if(null==e)return{};var a={};for(var t in e)if({}.hasOwnProperty.call(e,t)){if(-1!==s.indexOf(t))continue;a[t]=e[t]}return a}(e,s);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(t=0;t<l.length;t++)a=l[t],-1===s.indexOf(a)&&{}.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}(a,i);return(0,r.createElement)("svg",(0,t.A)((0,t.A)({ref:n},l),{},{width:d,height:d,stroke:c,strokeWidth:h?24*Number(o)/Number(d):o,className:["lucide","lucide-".concat((v=e,v.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim())),m].join(" ")},x),[...s.map(e=>{let[s,a]=e;return(0,r.createElement)(s,a)}),...Array.isArray(j)?j:[j]]);var v});return a.displayName="".concat(e),a}}}]);
//# sourceMappingURL=261.6c0e9af6.chunk.js.map