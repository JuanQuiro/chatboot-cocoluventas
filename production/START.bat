@echo off
REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
REM โ                                                                            โ
REM โ                    COCOLU VENTAS - SCRIPT DE INICIO (Windows)              โ
REM โ                                                                            โ
REM โ  Este script levanta TODO el sistema de una vez:                          โ
REM โ  โข Dashboard (React)                                                      โ
REM โ  โข API REST (Express)                                                     โ
REM โ  โข Bot WhatsApp (BuilderBot + Meta)                                       โ
REM โ                                                                            โ
REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

setlocal enabledelayedexpansion

REM Configuraciรณn
set PORT=5001
set API_PORT=5000
set BOT_ADAPTER=meta
set NODE_ENV=production

echo.
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo โ                                                                            โ
echo โ                    COCOLU VENTAS - INICIANDO SISTEMA                       โ
echo โ                                                                            โ
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo.

REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
REM PASO 1: VERIFICAR DEPENDENCIAS
REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

echo [1/5] Verificando dependencias...

where node >nul 2>nul
if %errorlevel% neq 0 (
    echo โ Node.js no estรก instalado
    exit /b 1
)

where npm >nul 2>nul
if %errorlevel% neq 0 (
    echo โ npm no estรก instalado
    exit /b 1
)

for /f "tokens=*" %%i in ('node -v') do set NODE_VERSION=%%i
for /f "tokens=*" %%i in ('npm -v') do set NPM_VERSION=%%i

echo โ Node.js %NODE_VERSION%
echo โ npm %NPM_VERSION%

REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
REM PASO 2: INSTALAR DEPENDENCIAS
REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

echo.
echo [2/5] Instalando dependencias...

if not exist "node_modules" (
    echo   โ Instalando dependencias del backend...
    call npm install --legacy-peer-deps
    echo   โ Backend listo
) else (
    echo   โ Backend ya tiene dependencias
)

if not exist "dashboard\node_modules" (
    echo   โ Instalando dependencias del dashboard...
    cd dashboard
    call npm install --legacy-peer-deps
    cd ..
    echo   โ Dashboard listo
) else (
    echo   โ Dashboard ya tiene dependencias
)

REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
REM PASO 3: COMPILAR DASHBOARD
REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

echo.
echo [3/5] Compilando dashboard...

if not exist "dashboard\build" (
    echo   โ Compilando React...
    cd dashboard
    set GENERATE_SOURCEMAP=false
    call npm run build
    cd ..
    echo   โ Dashboard compilado
) else (
    echo   โ Dashboard ya estรก compilado
)

REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
REM PASO 4: VERIFICAR CONFIGURACIรN
REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

echo.
echo [4/5] Verificando configuraciรณn...

if not exist ".env" (
    echo โ๏ธ  Archivo .env no encontrado
    echo   Crea un archivo .env con las variables de Meta:
    echo     META_JWT_TOKEN=tu_token
    echo     META_NUMBER_ID=tu_numero
    echo     META_VERIFY_TOKEN=tu_verify_token
) else (
    echo   โ Archivo .env encontrado
)

REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
REM PASO 5: INICIAR SISTEMA
REM โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

echo.
echo [5/5] Iniciando sistema...
echo.

echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo โ                                                                            โ
echo โ                    ๐ SISTEMA INICIANDO                                    โ
echo โ                                                                            โ
echo โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
echo.

set PORT=%PORT%
set API_PORT=%API_PORT%
set BOT_ADAPTER=%BOT_ADAPTER%
set NODE_ENV=%NODE_ENV%

call npm start

endlocal
